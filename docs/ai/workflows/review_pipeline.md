# Review Pipeline Go2Asia  
Документ описывает, **когда и как** запускаются режимы ревью (sub-agent / review-mode) у ключевых ИИ-агентов.

Основная цель — встроить ревью в стандартный цикл разработки так, чтобы:
- не забывать о контрольных точках,
- не превращать ревью в хаотичную «доп. опцию»,
- минимизировать архитектурный и технический долг.

---

## 1. Общий принцип

Для каждого крупного артефакта (ТЗ, архитектура, план, код) действует правило:

> **Сначала создание основным агентом → затем обязательное ревью субагентом (review-mode)**

Ревью-режимы:
- ТЗ → `Requirements Analyst` (режим *TЗ-review*),
- Архитектура → `Architect` (режим *Architecture-review*),
- План → `Planner` (режим *Plan-review*),
- Код → `Backend Dev` в связке с `QA` и `Security` (режим *Code-review*).

Результаты ревью всегда фиксируются в `docs/reviews/**`.

---

## 2. Точки запуска ревью по артефактам

### 2.1. Техническое задание (TЗ)

**Ответственный основной агент:**  
- `Requirements Analyst` (ИИ-аналитик)

**Когда запускать ревью:**
- после подготовки первичной версии ТЗ для:
  - новой Фазы,
  - нового модуля (Atlas, Pulse, Blog, RF, Rielt, Quest, Space, Connect, Guru),
  - нового микросервиса или крупного API.

**Кто ревьюит (review-mode):**
- тот же `Requirements Analyst`, но в режиме **Review / Sub-agent Mode: Ревью ТЗ**.

**Что делаем:**
1. Аналитик завершает черновик ТЗ → сохраняет в `docs/modules/...` или `docs/backend/...`.
2. Переходит в режим ревью:
   - сверяет структуру,
   - проверяет критерии приёмки,
   - проверяет непротиворечивость и связку с roadmap.
3. Пишет отчёт:
   - `docs/reviews/tz/review_<yyyy-mm-dd>_<name>.md`
   - формат: краткий summary, список замечаний, статус: `approve` / `changes required`.

---

### 2.2. Архитектура

**Ответственный основной агент:**  
- `Architect` (ИИ-архитектор)

**Когда запускать ревью:**
- после подготовки:
  - новой архитектуры микросервиса,
  - изменений в API-архитектуре,
  - новых схем данных, влияющих на несколько сервисов,
  - изменений в `system_architecture`, `microservices`, `api_architecture`.

**Кто ревьюит (review-mode):**
- тот же `Architect`, но в режиме **Архитектурное ревью**.

**Что делаем:**
1. Архитектор подготавливает архитектурный документ:
   - `docs/architecture/*.md` или
   - `docs/backend/<service>/architecture.md`.
2. Запускает review-mode:
   - сверяет границы сервисов,
   - проверяет совместимость с ADR,
   - проверяет схемы данных и API,
   - оценивает масштабируемость и устойчивость.
3. Пишет отчёт:
   - `docs/reviews/architecture/review_<yyyy-mm-dd>_<scope>.md`
   - фиксирует замечания, риски, решение: `approve` / `changes required`.

---

### 2.3. План разработки (Фаза / Этап / Sprint)

**Ответственный основной агент:**  
- `Planner` (ИИ-планировщик)

**Когда запускать ревью:**
- после подготовки:
  - плана Фазы (Phase),
  - плана крупного Этапа,
  - важного внутреннего sprint-документа (например, `sprint_000_setup.md`).

**Кто ревьюит (review-mode):**
- тот же `Planner` в режиме **Ревью плана разработки**.

**Что делаем:**
1. Планировщик формирует план:
   - `docs/plans/phase_*.md`, `docs/plans/sprint_*.md`.
2. Переходит в review-mode:
   - проверяет зависимости и блокирующие задачи,
   - сверяется с ТЗ и архитектурой,
   - оценивает риски.
3. Пишет отчёт:
   - `docs/reviews/plans/review_<yyyy-mm-dd>_<phase_or_sprint>.md`.

---

### 2.4. Код (backend, критичный frontend, SDK)

**Ответственные основные агенты:**
- `Backend Dev` (+ совместный режим с `QA` и `Security`)

**Когда запускать ревью:**
- перед merge значимых изменений:
  - новые эндпоинты микросервисов,
  - изменения в моделях данных,
  - изменения в пакете `packages/sdk` или `packages/types`,
  - изменения в критичных частях `packages/ui`.

**Кто ревьюит (review-mode):**
- `Backend Dev` в режиме **Код-ревью**,  
  совместно с:
  - `QA` (качество и тестируемость),
  - `Security` (безопасность).

**Что делаем:**
1. Бэкенд-агент реализует изменения в коде.
2. Перед merge:
   - включает review-mode,
   - проверяет архитектуру, ошибки, стилистику,
   - QA оценивает тестируемость и тесты,
   - Security оценивает безопасность.
3. Пишется отчёт:
   - `docs/reviews/code/review_<yyyy-mm-dd>_<service_or_module>.md`.

---

## 3. Встраивание review-пайплайна в общий workflow

Review-пайплайн встроен в итерационный цикл:

1. **Task intake & анализ** → TЗ  
   → **TЗ-revью** (`Requirements Analyst` review-mode).

2. **Архитектура** (по ТЗ)  
   → **Architect-review** (review-mode).

3. **Планирование (Phase/Sprint)**  
   → **Plan-review** (`Planner` review-mode).

4. **Реализация (код)**  
   → **Code-review** (Backend+QA+Security review-mode).

5. **Тестирование и приёмка**  
   → финальный чек с опорой на результаты ревью.

---

## 4. Каталоги для результатов ревью

Все результаты ревью складываются в единое дерево:

```text
docs/
  reviews/
    tz/
      review_YYYY-MM-DD_<name>.md
    architecture/
      review_YYYY-MM-DD_<scope>.md
    plans/
      review_YYYY-MM-DD_<phase_or_sprint>.md
    code/
      review_YYYY-MM-DD_<service_or_module>.md
```

Это позволяет:
- отслеживать качество решений,
- видеть историю правок,
- использовать прошлые замечания как базу знаний.

---

## 5. Правило для Cursor / Оркестратора

При работе над задачей, которая создаёт или меняет:
- ТЗ,
- архитектуру,
- план,
- значимый backend/SDK/UI-код,
Оркестратор обязан:
1. Проверить review_pipeline.md.
2. Включить нужный review-mode соответствующего агента.
3. Сохранить результат ревью в docs/reviews/**.
Если ревью даёт статус changes required — доработать артефакт и повторить ревью.