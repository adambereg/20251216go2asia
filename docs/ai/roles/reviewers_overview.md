# Обзор ревью-агентов Go2Asia  
## Единая система Sub-agent Review Mode

Данный документ описывает **всех ревьюеров**, участвующих в мультиагентной разработке Go2Asia, а также ситуации, в которых каждый из них запускается в режиме **sub-agent review**.

Система ревью выстроена вокруг принципа:

> **Основные агенты (Architect, Planner, Requirements Analyst, Backend Dev) вызывают ревью-агентов автоматически в нужные моменты работы.**  
> Пользователь не должен сам вручную подключать ревьюеров — этим занимается Orchestrator + Review Pipeline.

---

# 1. Перечень ревьюеров

Go2Asia использует *четыре официальных субагента ревью*:

| Ревьюер | Область ответственности | Типовые моменты запуска |
|--------|--------------------------|--------------------------|
| **Architecture Reviewer** | архитектура, структуры данных, микросервисы, интеграции | перед созданием/изменением архитектуры |
| **Planning Reviewer** | планы развития, фазы, этапы, структуры работ | после генерации плана Planner-агентом |
| **Requirements Reviewer** | технические задания, формальные требования | после черновика ТЗ, перед началом разработки модуля |
| **Code Reviewer** (Backend Dev + QA + Security) | анализ кода, качество тестов, безопасность | при завершении backend-этапов или перед merge |

---

# 2. Кто вызывает ревьюеров

| Агент | Когда вызывает ревьюеров | Кого именно вызывает |
|------|--------------------------|----------------------|
| **Orchestrator** | При смене стадии работы, перед большими задачами | Всех по необходимости согласно Review Pipeline |
| **Requirements Analyst** | Когда черновик ТЗ сформирован | Requirements Reviewer |
| **Architect** | Когда сформирована архитектура модуля/сервиса | Architecture Reviewer |
| **Planner** | Когда создан план разработки фазы/этапа | Planning Reviewer |
| **Backend Dev** | Когда закончен блок backend-кода, API или логики | Code Reviewer (backend+QA+security submode) |

---

# 3. Общие принципы Review Mode

### Review Mode активируется, когда:
- создаётся **новая архитектура** модуля или сервиса;
- создаётся или изменяется **ТЗ**;
- создаётся **план разработки**;
- завершён значимый блок **backend-кода**;
- требуется проверка безопасности и качества.

### В Review Mode агент:

1. **Не создаёт новый код**  
2. **Только анализирует** присланный артефакт  
3. **Пишет замечания, риски, рекомендации**  
4. Даёт вердикт:  
   - `approved`  
   - `approved_with_comments`  
   - `needs_revision`  

---

# 4. Описание каждого ревьюера

---

## 4.1 Requirements Reviewer (ревью Технических Заданий)

### Запускается когда:
- Requirements Analyst завершил черновик ТЗ для модуля, сервиса или функционального блока.

### Проверяет:
- полноту функциональных требований,
- корректность допущений,
- непротиворечивость терминов,
- связь требований с бизнес-задачами,
- отсутствие логических дыр.

### Выход:
Файл вида  
`docs/reviews/requirements/review_<date>.md`  
со статусом и рекомендациями.

---

## 4.2 Architecture Reviewer (ревью архитектуры)

### Запускается когда:
- Architect создал архитектуру микросервиса, модуля или важного интеграционного компонента.

### Проверяет:
- микросервисную декомпозицию,
- соответствие ADR,
- корректность интеграций и API-границ,
- выбор технологий,
- схемы данных и ограничения,
- масштабируемость и отказоустойчивость.

### Выход:
`docs/reviews/architecture/review_<date>.md`

---

## 4.3 Planning Reviewer (ревью планов разработки)

### Запускается когда:
- Planner сгенерировал план Фазы/Этапа.

### Проверяет:
- реалистичность последовательности работ,
- корректность разбивки,
- учёт зависимостей между модулями,
- соответствие приоритетам,
- соблюдение технических ограничений.

### Выход:
`docs/reviews/plans/review_<date>.md`

---

## 4.4 Code Reviewer (backend + QA + Security)

Это **комбинированный ревьюер**, состоящий из трёх субагентов:

| Субагент | Ответственность |
|----------|-----------------|
| **Backend Reviewer** | логика, API, структуры данных, обработка ошибок |
| **QA Reviewer** | тестируемость, покрытие, качество поведения |
| **Security Reviewer** | безопасность, уязвимости, токены, ACL |

### Запускается когда:
- Backend Dev завершил реализацию функционального блока,
- изменена критичная логика сервиса,
- меняются API или схемы данных.

### Проверяет:
- читаемость и корректность кода,
- соответствие архитектуре и ТЗ,
- ошибки проектирования и edge cases,
- безопасность:
  - JWT,
  - доступы,
  - XSS/SQLi/CSRF,
  - ошибки конфигурации,
- полноту тестов.

### Выход:
`docs/reviews/code/review_<date>.md`  
С указанием пометок:

- `[BACKEND]`
- `[QA]`
- `[SECURITY]`

---

# 5. Взаимодействие ревьюеров с Review Pipeline

Review Pipeline (см. `docs/ai/workflows/review_pipeline.md`) формально определяет:

- кто кого вызывает,  
- в какой последовательности,  
- какие артефакты проверяются,  
- куда складываются результаты.  

Согласно Pipeline:

| Стадия | Кто запускает ревью | Какой ревьюер |
|--------|----------------------|----------------|
| Формирование требований | Requirements Analyst | Requirements Reviewer |
| Архитектурная разработка | Architect | Architecture Reviewer |
| Планирование фаз | Planner | Planning Reviewer |
| Backend-разработка | Backend Dev | Code + QA + Security Reviewers |

---

# 6. Где расположены материалы ревью

После каждого вызова субагента формируется:

```
docs/reviews/
  ├── requirements/
  │     └── review_YYYY-MM-DD.md
  ├── architecture/
  │     └── review_YYYY-MM-DD.md
  ├── plans/
  │     └── review_YYYY-MM-DD.md
  └── code/
        └── review_YYYY-MM-DD.md
```

Orchestrator автоматически обращается к этим файлам при завершении этапов.

---

# 7. Правила интеграции ревьюеров (как должен действовать Cursor)

Чтобы Cursor корректно работал согласно системе ревью:

1. **Если создано ТЗ → вызвать Requirements Reviewer**  
2. **Если изменена архитектура → вызвать Architecture Reviewer**  
3. **Если сформирован план → вызвать Planning Reviewer**  
4. **Если завершён backend-код → вызвать Code Reviewer (backend+QA+security)**  
5. **Все ревью складываются строго в папку `/docs/reviews/...`**  
6. **Orchestrator отслеживает статусы ревью**  
7. **Если статус = needs_revision → вернуться к доработке**  
8. **Если все статус = approved → можно продолжать разработку**

---

# 8. Мини-справочник: Когда что запускать?

| Ситуация | Кто запускается |
|----------|-----------------|
| Создано новое ТЗ | Requirements Reviewer |
| Изменён микросервис / интеграция | Architecture Reviewer |
| Создан план фазы/модуля | Planning Reviewer |
| Завершён backend-код | Code Reviewer (Backend + QA + Security) |

---

# 9. Главное отличие новой системы

Раньше ревьюеры были **отдельными ролями**, вызываемыми вручную.  
Теперь они — **автоматические субагенты** внутри общего мультиагентного конвейера.  

Это делает разработку:
- последовательной,
- проверяемой,
- самоконтролируемой,
- устойчивой к ошибкам.
