# Backend Architecture — Архитектура server-side части Go2Asia

Этот документ описывает устройство backend-уровня и распределение ответственности между микросервисами.

---

## 1. Общие принципы

- Микросервисная архитектура: каждый домен — отдельный сервис.
- Сервисы общаются через HTTP (REST) и/или асинхронные события.
- Общая реляционная БД (или несколько логически разделённых схем) + специфичные хранилища при необходимости.
- Язык и стек: Node.js + TypeScript (ориентир), ORM — Drizzle/Prisma, БД — PostgreSQL.

---

## 2. Список ключевых сервисов

Примерный набор (может уточняться):

- **User/Auth Service**
  - пользователи, роли (Guest, User, VIP, PRO, Partner, Admin);
  - JWT, refresh-токены;
  - профили, настройки.

- **Atlas Service**
  - страны, города, места, гайды, темы;
  - связи с RF и Guru.

- **Pulse Service**
  - события, расписания, категории;
  - статусы участия, лимиты.

- **Media/Blog Service**
  - статьи, рубрики, темы;
  - внутриконтентные теги.

- **Guru Service**
  - подбор «рядом со мной»;
  - рекомендации по местам, маршрутам, сервисам.

- **RF Service (Russian Friendly)**
  - партнёрские заведения, услуги;
  - статусы партнёров, геопривязка.

- **Rielt Service**
  - объекты недвижимости (аренда/продажа);
  - заявки, статусы, избранное.

- **Quest Service**
  - квесты, задания, прогресс пользователей.

- **Referral/Connect Service**
  - реферальные связи;
  - амбассадоры, реферальные схемы.

- **Points Service**
  - внутренние баллы (soft currency);
  - правила начисления и списания.

- **NFT Service**
  - внутренняя модель NFT/бейджей.

- **Blockchain Gateway Service**
  - связь с блокчейном (TON и др.);
  - мост между off-chain балансами и on-chain.

- **Notification Service**
  - email/push/ин-апп уведомления.

- **Logging/Analytics Service**
  - технические логи;
  - событийная аналитика (какие действия совершал пользователь).

---

## 3. Общие технические элементы

- **API Gateway/Edge Layer**:
  - поверх всех сервисов;
  - авторизация, маршрутизация, rate limiting.

- **Организация кода**:
  - каждый сервис в отдельной директории/репозитории или как сервис-пакет в монорепо;
  - общий слой библиотек (shared utils, DTO, типы).

---

## 4. Коммуникация между сервисами

- Синхронно:
  - REST-запросы (JSON) через внутреннюю сеть.
- Асинхронно:
  - события (например, «voucher_purchased», «points_awarded», «user_registered»);
  - брокер сообщений / очередь (по возможности).

---

## 5. Безопасность и права доступа

- Все запросы проходят через API Gateway.
- Внутри сервисов — проверка ролей и прав на основе JWT и внутренних правил.
- Доступ к административным API ограничен.

---

## 6. Связанные документы

- `architecture/api_architecture.md`
- `architecture/microservices.md`
- `architecture/data_flow.md`
- `architecture/caching_and_performance.md`
