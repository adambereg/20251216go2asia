# ADR 0011: Единая БД с разделением по схемам для MVP

## Статус
Принято

## Дата решения
2025-01-16

## Контекст

MVP Go2Asia требует простую архитектуру БД. Полная экосистема может использовать отдельные БД для каждого сервиса, но для MVP это избыточно и усложняет управление.

## Решение

Использовать одну Neon PostgreSQL базу данных с разделением по схемам (`auth`, `content`, `points`, `referral`). Каждый сервис владеет своей схемой.

## Обоснование

1. **Упрощение для MVP:** Не нужно управлять несколькими БД
2. **Neon поддерживает схемы:** PostgreSQL схемы обеспечивают логическое разделение
3. **Логическое разделение сохранено:** Каждый сервис владеет своей схемой
4. **Готовность к миграции:** В будущем можно мигрировать на отдельные БД при необходимости

## Последствия

### Плюсы
- Простота управления (одна точка подключения)
- Упрощённые бэкапы (одна БД)
- Меньше overhead на подключения
- Легче миграции между схемами (если нужно)

### Минусы
- Потенциальная связанность на уровне БД (митигируется через схемы)
- Один сервис может влиять на производительность других (митигируется через индексы и оптимизацию)
- Сложнее изоляция при масштабировании (решается миграцией на отдельные БД)

### Митигация рисков
- Строгие правила доступа (сервис может читать только свою схему)
- Индексы и оптимизация запросов для производительности
- Мониторинг производительности каждой схемы
- Готовность к миграции на отдельные БД при росте нагрузки

## Альтернативы

### Альтернатива 1: Отдельные БД для каждого сервиса
- Каждый сервис имеет свою БД в Neon
- Плюсы: Полная изоляция, независимое масштабирование
- Минусы: Сложнее управление, больше overhead, избыточно для MVP
- Решение: Отложено на post-MVP при необходимости

### Альтернатива 2: Монолитная БД без схем
- Одна БД без разделения по схемам
- Плюсы: Максимальная простота
- Минусы: Нарушает принципы микросервисов, сложнее миграция в будущем
- Решение: Отклонено (нарушает архитектурные принципы)

## Связанные решения

- ADR 0002: Выбор Drizzle ORM
- ADR 0007: Правила выделения границ микросервисов

## Примечания

В post-MVP при росте нагрузки можно мигрировать на отдельные БД:
1. Каждый сервис получает свою БД в Neon
2. Миграция данных из схем в отдельные БД
3. Обновление connection strings в сервисах
4. Минимальные изменения в коде (Drizzle ORM поддерживает разные БД)





