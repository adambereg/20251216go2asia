# План реализации MVP Go2Asia

**Версия:** 1.0  
**Дата:** 2025-01-16  
**Автор:** Planner  
**Статус:** Draft → на ревью  
**Основа:** 
- ТЗ MVP v1.1 (APPROVED)
- Архитектура MVP v1.1 (APPROVED)

---

## Обзор плана

План реализации MVP разбит на 5 милстоунов (этапов), каждый из которых завершается проверяемым результатом. Работа организована по принципу вертикальных срезов: от инфраструктуры к функциональности, от backend к frontend, от базовых сервисов к интеграции.

**Принципы планирования:**
- Минимальный вертикальный срез на каждом этапе
- Параллельная работа команд где возможно
- Чёткие критерии готовности для каждого милстоуна
- OpenAPI-first подход (API описываются перед реализацией)

---

## Milestone 1: Foundation & Infrastructure

**Цель:** Создать техническую основу для MVP: монорепозиторий, базовые пакеты, API Gateway, миграции БД.

**Длительность:** 5-7 дней

### Задачи

#### Backend Infrastructure

**M1-BE-001: Настройка монорепозитория**
- **Приоритет:** P0 (критично)
- **Роль:** DevOps
- **Описание:**
  - Настроить pnpm workspaces
  - Настроить Turborepo для кэширования сборок
  - Создать базовую структуру директорий (`apps/`, `services/`, `packages/`)
  - Настроить общие конфиги (TypeScript, ESLint, Prettier)
- **Зависимости:** Нет
- **Критерии готовности:**
  - `pnpm install` работает без ошибок
  - `pnpm build` собирает все пакеты
  - Структура директорий соответствует архитектуре

**M1-BE-002: Создание базовых пакетов**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - `packages/types/` — структура для автогенерируемых типов из OpenAPI
  - `packages/sdk/` — структура для автогенерируемого API клиента
  - `packages/logger/` — единый логгер с requestId поддержкой
  - `packages/schemas/` — Zod схемы для валидации
  - `packages/config/` — общие конфиги (eslint, tsconfig, prettier)
- **Зависимости:** M1-BE-001
- **Критерии готовности:**
  - Все пакеты собираются без ошибок
  - Logger поддерживает requestId
  - Zod схемы готовы к использованию

**M1-BE-003: Настройка OpenAPI-first процесса**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Настроить Orval для генерации типов и SDK из OpenAPI
  - Создать базовую структуру `docs/openapi/`
  - Настроить скрипты `gen:types` и `gen:sdk`
  - Добавить валидацию OpenAPI в CI (spectral)
- **Зависимости:** M1-BE-002
- **Критерии готовности:**
  - `pnpm gen:types` генерирует типы из OpenAPI
  - `pnpm gen:sdk` генерирует SDK клиент
  - CI валидирует OpenAPI спецификации

**M1-BE-004: Создание API Gateway (базовая версия)**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать Cloudflare Worker для API Gateway
  - Реализовать базовую маршрутизацию (`/v1/auth/*`, `/v1/content/*`, `/v1/points/*`, `/v1/referral/*`)
  - Реализовать health checks (`/health`, `/ready`)
  - Добавить логирование с requestId
  - Настроить деплой через GitHub Actions
- **Зависимости:** M1-BE-002, M1-BE-003
- **Критерии готовности:**
  - Gateway развёрнут на Cloudflare Workers
  - Health checks возвращают 200 OK
  - Логирование работает с requestId
  - Маршрутизация настроена (пока без реальных сервисов)

**M1-BE-005: Настройка Neon PostgreSQL и миграций**
- **Приоритет:** P0 (критично)
- **Роль:** DevOps / Backend Dev
- **Описание:**
  - Настроить подключение к Neon PostgreSQL
  - Настроить Drizzle ORM для миграций
  - Создать структуру миграций для всех схем (`auth`, `content`, `points`, `referral`)
  - Настроить скрипты для запуска миграций
  - Настроить бэкапы (базовая версия)
- **Зависимости:** M1-BE-001
- **Критерии готовности:**
  - Подключение к Neon работает
  - Миграции можно запускать через `pnpm migrate`
  - Структура миграций соответствует схемам из архитектуры

#### Frontend Infrastructure

**M1-FE-001: Создание PWA Shell (базовая версия)**
- **Приоритет:** P0 (критично)
- **Роль:** Frontend Dev
- **Описание:**
  - Создать Next.js 15 проект в `apps/go2asia-pwa-shell/`
  - Настроить App Router структуру (`(public)/`, `(authenticated)/`)
  - Интегрировать Clerk SSO (базовая интеграция)
  - Настроить базовый layout (header, navigation, footer)
  - Настроить деплой на Netlify
- **Зависимости:** M1-BE-001
- **Критерии готовности:**
  - PWA Shell развёрнут на Netlify
  - Clerk SSO работает (базовая авторизация)
  - Базовый layout отображается
  - Роутинг настроен

**M1-FE-002: Создание базовых UI компонентов**
- **Приоритет:** P1 (важно)
- **Роль:** Frontend Dev
- **Описание:**
  - Создать `packages/ui/` на основе design-system
  - Реализовать базовые компоненты (Button, Card, Badge, Input)
  - Настроить Tailwind CSS и shadcn/ui
  - Создать базовые компоненты навигации (TopAppBar, BottomNav)
- **Зависимости:** M1-BE-001, M1-FE-001
- **Критерии готовности:**
  - UI компоненты собираются без ошибок
  - Компоненты соответствуют design-system
  - Tailwind CSS настроен

#### DevOps & CI/CD

**M1-DEVOPS-001: Настройка CI/CD Pipeline**
- **Приоритет:** P0 (критично)
- **Роль:** DevOps
- **Описание:**
  - Настроить GitHub Actions для PR checks (lint, typecheck, build)
  - Настроить деплой на staging (автоматический при merge в main)
  - Настроить деплой на production (вручную через GitHub Actions)
  - Настроить preview deployments для PR (Netlify для фронтенда)
- **Зависимости:** M1-BE-001, M1-FE-001
- **Критерии готовности:**
  - PR checks работают (lint, typecheck, build)
  - Preview deployments создаются для каждого PR
  - Staging деплой работает автоматически

### Критерии готовности Milestone 1

- ✅ Монорепозиторий настроен и работает
- ✅ Базовые пакеты созданы и собираются
- ✅ OpenAPI-first процесс настроен
- ✅ API Gateway развёрнут и отвечает на health checks
- ✅ Neon PostgreSQL настроен, миграции работают
- ✅ PWA Shell развёрнут на Netlify
- ✅ Базовые UI компоненты созданы
- ✅ CI/CD pipeline работает

---

## Milestone 2: Auth Service & Content Service

**Цель:** Реализовать базовые сервисы для аутентификации и контента. Создать seed данные для демонстрации.

**Длительность:** 7-10 дней

### Задачи

#### Auth Service

**M2-BE-001: OpenAPI спецификация Auth Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать `docs/openapi/auth.yaml`
  - Описать все endpoints Auth Service (публичные и internal)
  - Описать схемы данных (User, UserProfile)
  - Сгенерировать типы и SDK
- **Зависимости:** M1-BE-003
- **Критерии готовности:**
  - OpenAPI спецификация валидна (spectral)
  - Типы и SDK сгенерированы

**M2-BE-002: Реализация Auth Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать Cloudflare Worker для Auth Service
  - Реализовать миграции БД (схема `auth`, таблицы `users`, `user_profiles`)
  - Реализовать обработку webhooks от Clerk (`user.created`, `user.updated`)
  - Реализовать `POST /internal/auth/verify-jwt` (для Gateway)
  - Реализовать `GET /v1/auth/profile` и `GET /v1/auth/roles`
  - Реализовать Service JWT генерацию и валидацию
- **Зависимости:** M2-BE-001, M1-BE-005
- **Критерии готовности:**
  - Auth Service развёрнут на Cloudflare Workers
  - Webhooks от Clerk обрабатываются корректно
  - JWT валидация работает
  - Service JWT работает (генерация и валидация)

**M2-BE-003: Интеграция Auth Service с API Gateway**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Обновить Gateway для маршрутизации `/v1/auth/*` → Auth Service
  - Реализовать проверку User JWT через Auth Service
  - Реализовать передачу `X-User-ID` в заголовках
  - Реализовать проверку ролей для административных операций
- **Зависимости:** M2-BE-002, M1-BE-004
- **Критерии готовности:**
  - Gateway маршрутизирует запросы к Auth Service
  - JWT валидация работает через Gateway
  - Роли проверяются корректно

#### Content Service

**M2-BE-004: OpenAPI спецификация Content Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать `docs/openapi/content.yaml`
  - Описать все endpoints Content Service (публичные GET и административные POST/PUT/DELETE)
  - Описать схемы данных (Country, City, Place, Event, Article, EventRegistration)
  - Сгенерировать типы и SDK
- **Зависимости:** M1-BE-003
- **Критерии готовности:**
  - OpenAPI спецификация валидна (spectral)
  - Типы и SDK сгенерированы

**M2-BE-005: Реализация Content Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать Cloudflare Worker для Content Service
  - Реализовать миграции БД (схема `content`, все таблицы)
  - Реализовать публичные GET endpoints (places, events, articles)
  - Реализовать административные POST/PUT/DELETE endpoints (с проверкой роли admin)
  - Реализовать поиск и фильтрацию
  - Реализовать регистрацию на события (`POST /v1/content/events/{id}/register`)
- **Зависимости:** M2-BE-004, M1-BE-005, M2-BE-003
- **Критерии готовности:**
  - Content Service развёрнут на Cloudflare Workers
  - Все GET endpoints работают
  - Административные endpoints защищены проверкой роли
  - Регистрация на события работает

**M2-BE-006: Интеграция Content Service с API Gateway**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Обновить Gateway для маршрутизации `/v1/content/*` → Content Service
  - Реализовать кэширование публичных GET запросов (TTL 600 секунд)
  - Реализовать передачу `X-User-ID` для авторизованных запросов
- **Зависимости:** M2-BE-005, M1-BE-004
- **Критерии готовности:**
  - Gateway маршрутизирует запросы к Content Service
  - Кэширование работает (Cache-Control заголовки)
  - Авторизованные запросы получают `X-User-ID`

#### Seed Data

**M2-BE-007: Создание seed данных**
- **Приоритет:** P1 (важно)
- **Роль:** Backend Dev / Content Manager
- **Описание:**
  - Создать SQL файлы seed данных:
    - `001_countries.sql` (7 стран)
    - `002_cities.sql` (10-15 городов)
    - `003_places.sql` (30-50 мест)
    - `004_events.sql` (10-15 событий)
    - `005_articles.sql` (10 статей)
  - Обеспечить идемпотентность (INSERT ... ON CONFLICT DO NOTHING)
  - Проверить UTF-8 кодировку
- **Зависимости:** M2-BE-005
- **Критерии готовности:**
  - Seed данные загружаются без ошибок
  - Идемпотентность работает (можно запускать многократно)
  - UTF-8 кодировка проверена

**M2-BE-008: Настройка процесса загрузки seed данных**
- **Приоритет:** P1 (важно)
- **Роль:** DevOps / Backend Dev
- **Описание:**
  - Создать команду `pnpm seed` для загрузки seed данных
  - Настроить автоматическую загрузку seed данных при первом деплое на staging
  - Добавить проверку кодировки UTF-8 в CI
- **Зависимости:** M2-BE-007
- **Критерии готовности:**
  - `pnpm seed` работает
  - Seed данные загружаются автоматически на staging
  - Проверка кодировки работает в CI

### Критерии готовности Milestone 2

- ✅ Auth Service реализован и развёрнут
- ✅ Content Service реализован и развёрнут
- ✅ Webhooks от Clerk обрабатываются корректно
- ✅ JWT валидация работает через Gateway
- ✅ Публичный контент доступен через Gateway
- ✅ Административные операции защищены проверкой роли
- ✅ Seed данные загружены и доступны

---

## Milestone 3: Points Service & Referral Service

**Цель:** Реализовать систему Points и реферальную программу. Интегрировать с Auth и Content сервисами.

**Длительность:** 7-10 дней

### Задачи

#### Points Service

**M3-BE-001: OpenAPI спецификация Points Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать `docs/openapi/points.yaml`
  - Описать все endpoints Points Service (публичные GET и internal POST)
  - Описать схемы данных (PointsTransaction, UserBalance, UserBadge)
  - Сгенерировать типы и SDK
- **Зависимости:** M1-BE-003
- **Критерии готовности:**
  - OpenAPI спецификация валидна (spectral)
  - Типы и SDK сгенерированы

**M3-BE-002: Реализация Points Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать Cloudflare Worker для Points Service
  - Реализовать миграции БД (схема `points`, таблицы `points_transactions`, `user_balances`, `user_badges`)
  - Реализовать `POST /internal/points/add` с проверкой лимитов:
    - Per-action limits (registration: 1 раз, event_registration: 1 раз в день, и т.д.)
    - Общий velocity limit (1000 Points в час)
    - Идемпотентность через `external_id`
  - Реализовать VIP коэффициенты (1.5 для VIP-Spacer при referral_bonus)
  - Реализовать `GET /v1/points/balance` и `GET /v1/points/transactions`
  - Реализовать обновление агрегированного баланса (`user_balances`)
- **Зависимости:** M3-BE-001, M1-BE-005
- **Критерии готовности:**
  - Points Service развёрнут на Cloudflare Workers
  - Начисление Points работает с проверкой лимитов
  - VIP коэффициенты применяются корректно
  - Баланс и транзакции возвращаются корректно

**M3-BE-003: Интеграция Points Service с другими сервисами**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Интегрировать Auth Service → Points Service (начисление при регистрации, первом входе)
  - Интегрировать Content Service → Points Service (начисление при регистрации на событие)
  - Реализовать Service JWT для межсервисных вызовов
  - Реализовать таймауты (2 секунды) и graceful degradation
- **Зависимости:** M3-BE-002, M2-BE-002, M2-BE-005
- **Критерии готовности:**
  - Auth Service начисляет Points при регистрации и первом входе
  - Content Service начисляет Points при регистрации на событие
  - Service JWT работает для межсервисных вызовов
  - Таймауты и graceful degradation работают

#### Referral Service

**M3-BE-004: OpenAPI спецификация Referral Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать `docs/openapi/referral.yaml`
  - Описать все endpoints Referral Service (публичные GET и POST)
  - Описать схемы данных (ReferralLink, ReferralRelation)
  - Сгенерировать типы и SDK
- **Зависимости:** M1-BE-003
- **Критерии готовности:**
  - OpenAPI спецификация валидна (spectral)
  - Типы и SDK сгенерированы

**M3-BE-005: Реализация Referral Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Создать Cloudflare Worker для Referral Service
  - Реализовать миграции БД (схема `referral`, таблицы `referral_links`, `referral_relations`)
  - Реализовать генерацию referral_code (SSOT)
  - Реализовать `POST /v1/referral/generate-code` (internal, для Auth Service)
  - Реализовать `POST /v1/referral/register` (регистрация по реферальной ссылке)
  - Реализовать `GET /v1/referral/code`, `GET /v1/referral/tree`, `GET /v1/referral/stats`
  - Реализовать начисление бонусов через Points Service:
    - 200 Points рефералу при регистрации по реферальной ссылке
    - 100 Points рефереру при первом входе реферала (или 150 для VIP-Spacer)
- **Зависимости:** M3-BE-004, M1-BE-005, M3-BE-002
- **Критерии готовности:**
  - Referral Service развёрнут на Cloudflare Workers
  - Генерация referral_code работает (SSOT)
  - Регистрация по реферальной ссылке работает
  - Начисление бонусов работает корректно

**M3-BE-006: Интеграция Referral Service с Auth Service**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Интегрировать Auth Service → Referral Service (генерация referral_code при регистрации)
  - Обновить поток регистрации: Auth Service вызывает Referral Service для генерации referral_code
  - Реализовать обработку реферального кода при регистрации
- **Зависимости:** M3-BE-005, M2-BE-002
- **Критерии готовности:**
  - При регистрации пользователя генерируется referral_code через Referral Service
  - Регистрация по реферальной ссылке работает корректно
  - Реферальные связи создаются правильно

**M3-BE-007: Интеграция Referral Service с API Gateway**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev
- **Описание:**
  - Обновить Gateway для маршрутизации `/v1/referral/*` → Referral Service
  - Реализовать передачу `X-User-ID` для авторизованных запросов
- **Зависимости:** M3-BE-005, M1-BE-004
- **Критерии готовности:**
  - Gateway маршрутизирует запросы к Referral Service
  - Авторизованные запросы получают `X-User-ID`

### Критерии готовности Milestone 3

- ✅ Points Service реализован и развёрнут
- ✅ Referral Service реализован и развёрнут
- ✅ Начисление Points работает с проверкой лимитов
- ✅ VIP коэффициенты применяются корректно
- ✅ Реферальная программа работает (генерация кода, регистрация, начисление бонусов)
- ✅ Интеграция между сервисами работает (Service JWT, таймауты, graceful degradation)

---

## Milestone 4: Frontend Implementation

**Цель:** Реализовать фронтенд модули (Atlas, Pulse, Blog, Connect) с интеграцией backend API.

**Длительность:** 10-14 дней

### Задачи

#### PWA Shell Enhancement

**M4-FE-001: Улучшение PWA Shell**
- **Приоритет:** P0 (критично)
- **Роль:** Frontend Dev
- **Описание:**
  - Реализовать полноценную интеграцию Clerk SSO
  - Реализовать навигацию между модулями (Atlas, Pulse, Blog, Connect)
  - Реализовать Service Worker для офлайн-режима
  - Реализовать PWA Manifest
  - Реализовать базовую обработку ошибок (error boundaries)
- **Зависимости:** M1-FE-001, M2-BE-003
- **Критерии готовности:**
  - Clerk SSO работает полностью
  - Навигация между модулями работает
  - Service Worker кэширует контент для офлайн-режима
  - PWA может быть установлена на устройство

#### Feature Capsules

**M4-FE-002: Atlas UI Feature Capsule**
- **Приоритет:** P0 (критично)
- **Роль:** Frontend Dev
- **Описание:**
  - Создать `features/atlas-ui/` Feature Capsule
  - Реализовать страницу списка мест (`/atlas`)
  - Реализовать страницу деталей места (`/atlas/{id}`)
  - Реализовать поиск и фильтрацию
  - Реализовать офлайн-кэш (последние 20 просмотренных мест в IndexedDB)
  - Интегрировать с Content Service API через SDK
- **Зависимости:** M2-BE-005, M1-FE-002, M4-FE-001
- **Критерии готовности:**
  - Страницы Atlas отображаются корректно
  - Поиск и фильтрация работают
  - Офлайн-кэш работает (последние 20 мест доступны офлайн)
  - SSR/SSG работает для SEO

**M4-FE-003: Pulse UI Feature Capsule**
- **Приоритет:** P0 (критично)
- **Роль:** Frontend Dev
- **Описание:**
  - Создать `features/pulse-ui/` Feature Capsule
  - Реализовать страницу списка событий (`/pulse`)
  - Реализовать страницу деталей события (`/pulse/{id}`)
  - Реализовать фильтрацию по дате и категории
  - Реализовать регистрацию на событие (для авторизованных)
  - Реализовать офлайн-кэш (ближайшие события на 7 дней в IndexedDB)
  - Интегрировать с Content Service API через SDK
- **Зависимости:** M2-BE-005, M1-FE-002, M4-FE-001
- **Критерии готовности:**
  - Страницы Pulse отображаются корректно
  - Фильтрация работает
  - Регистрация на событие работает (для авторизованных)
  - Офлайн-кэш работает

**M4-FE-004: Blog UI Feature Capsule**
- **Приоритет:** P0 (критично)
- **Роль:** Frontend Dev
- **Описание:**
  - Создать `features/blog-ui/` Feature Capsule
  - Реализовать страницу списка статей (`/blog`)
  - Реализовать страницу детальной статьи (`/blog/{slug}`)
  - Реализовать фильтрацию по категориям и тегам
  - Реализовать поиск по статьям
  - Реализовать SSR/SSG для SEO
  - Интегрировать с Content Service API через SDK
- **Зависимости:** M2-BE-005, M1-FE-002, M4-FE-001
- **Критерии готовности:**
  - Страницы Blog отображаются корректно
  - Фильтрация и поиск работают
  - SSR/SSG работает для SEO
  - Статьи индексируются поисковыми системами

**M4-FE-005: Connect UI Feature Capsule**
- **Приоритет:** P0 (критично)
- **Роль:** Frontend Dev
- **Описание:**
  - Создать `features/connect-ui/` Feature Capsule
  - Реализовать страницу баланса Points (`/connect`)
  - Реализовать страницу истории транзакций
  - Реализовать страницу реферальной программы (код, дерево, статистика)
  - Реализовать страницу бейджей (виртуальные достижения)
  - Интегрировать с Points Service и Referral Service API через SDK
- **Зависимости:** M3-BE-002, M3-BE-005, M1-FE-002, M4-FE-001
- **Критерии готовности:**
  - Страницы Connect отображаются корректно
  - Баланс Points отображается
  - История транзакций отображается
  - Реферальная программа работает (код, дерево, статистика)
  - Бейджи отображаются

#### API Integration

**M4-FE-006: Интеграция Frontend с Backend API**
- **Приоритет:** P0 (критично)
- **Роль:** Frontend Dev
- **Описание:**
  - Настроить API клиент (автогенерируемый SDK)
  - Реализовать передачу JWT токенов в заголовках
  - Реализовать обработку ошибок API (401, 403, 500)
  - Реализовать retry логику для временных ошибок
  - Реализовать кэширование на клиенте (React Query)
- **Зависимости:** M1-BE-003, M4-FE-001
- **Критерии готовности:**
  - API клиент работает корректно
  - JWT токены передаются в заголовках
  - Ошибки обрабатываются корректно
  - Кэширование работает

### Критерии готовности Milestone 4

- ✅ Все Feature Capsules реализованы (Atlas, Pulse, Blog, Connect)
- ✅ Интеграция с Backend API работает
- ✅ Офлайн-режим работает (Service Worker кэширует контент)
- ✅ SSR/SSG работает для SEO (Atlas, Pulse, Blog)
- ✅ Регистрация на события работает
- ✅ Реферальная программа работает в UI
- ✅ Баланс Points отображается в UI

---

## Milestone 5: Integration, Testing & Polish

**Цель:** Интегрировать все компоненты, провести тестирование, подготовить к релизу.

**Длительность:** 5-7 дней

### Задачи

#### Integration

**M5-INT-001: End-to-End интеграция**
- **Приоритет:** P0 (критично)
- **Роль:** Backend Dev / Frontend Dev
- **Описание:**
  - Протестировать полные потоки:
    - Регистрация пользователя → начисление Points → отображение в Connect
    - Регистрация по реферальной ссылке → начисление бонусов → отображение в Connect
    - Регистрация на событие → начисление Points → отображение в Connect
    - Просмотр контента (Atlas, Pulse, Blog) → офлайн-доступ
  - Исправить найденные проблемы интеграции
- **Зависимости:** M4-FE-002, M4-FE-003, M4-FE-004, M4-FE-005
- **Критерии готовности:**
  - Все потоки работают end-to-end
  - Нет критических проблем интеграции

**M5-INT-002: Настройка Observability**
- **Приоритет:** P0 (критично)
- **Роль:** DevOps
- **Описание:**
  - Настроить структурированное логирование (requestId во всех логах)
  - Настроить Cloudflare Analytics для метрик
  - Настроить алерты (error rate > 5%, p95 latency > 500ms)
  - Создать базовые runbooks для типичных проблем
- **Зависимости:** M1-BE-004, M2-BE-002, M2-BE-005, M3-BE-002, M3-BE-005
- **Критерии готовности:**
  - Логирование работает с requestId
  - Метрики собираются
  - Алерты настроены

#### Testing

**M5-QA-001: Unit тесты для Backend сервисов**
- **Приоритет:** P1 (важно)
- **Роль:** Backend Dev / QA
- **Описание:**
  - Написать unit тесты для критических функций:
    - Начисление Points с проверкой лимитов
    - Генерация referral_code
    - Валидация JWT токенов
    - Обработка webhooks от Clerk
  - Использовать Vitest для тестирования
- **Зависимости:** M2-BE-002, M2-BE-005, M3-BE-002, M3-BE-005
- **Критерии готовности:**
  - Unit тесты покрывают критическую функциональность
  - Все тесты проходят

**M5-QA-002: Contract тесты для API**
- **Приоритет:** P1 (важно)
- **Роль:** Backend Dev / QA
- **Описание:**
  - Настроить Schemathesis для contract тестов
  - Протестировать все API endpoints на соответствие OpenAPI спецификации
  - Протестировать валидацию входных данных (Zod схемы)
- **Зависимости:** M2-BE-002, M2-BE-005, M3-BE-002, M3-BE-005
- **Критерии готовности:**
  - Contract тесты проходят для всех endpoints
  - Валидация работает корректно

**M5-QA-003: E2E тесты для критических потоков**
- **Приоритет:** P1 (важно)
- **Роль:** Frontend Dev / QA
- **Описание:**
  - Написать E2E тесты с Playwright:
    - Регистрация пользователя
    - Просмотр контента (Atlas, Pulse, Blog)
    - Регистрация на событие
    - Просмотр баланса Points
    - Реферальная программа
  - Настроить запуск E2E тестов в CI
- **Зависимости:** M4-FE-002, M4-FE-003, M4-FE-004, M4-FE-005
- **Критерии готовности:**
  - E2E тесты покрывают критические потоки
  - Все тесты проходят

**M5-QA-004: Ручное тестирование и баг-фиксы**
- **Приоритет:** P0 (критично)
- **Роль:** QA / Dev
- **Описание:**
  - Провести ручное тестирование всех функций MVP
  - Исправить найденные баги
  - Проверить производительность (время загрузки < 3 секунд)
  - Проверить доступность (mobile-first, PWA)
- **Зависимости:** M5-INT-001
- **Критерии готовности:**
  - Все функции работают корректно
  - Производительность соответствует требованиям
  - Доступность проверена

#### Documentation

**M5-DOC-001: Документация для разработчиков**
- **Приоритет:** P1 (важно)
- **Роль:** Dev / Tech Writer
- **Описание:**
  - Обновить README с инструкциями по запуску
  - Создать документацию по API (на основе OpenAPI)
  - Создать документацию по архитектуре (краткое резюме)
  - Создать runbooks для типичных проблем
- **Зависимости:** M5-INT-001
- **Критерии готовности:**
  - Документация актуальна и понятна
  - Runbooks созданы

#### Production Readiness

**M5-DEVOPS-001: Подготовка к Production**
- **Приоритет:** P0 (критично)
- **Роль:** DevOps
- **Описание:**
  - Настроить production окружение (Cloudflare Workers, Neon PostgreSQL, Netlify)
  - Настроить production деплой (вручную через GitHub Actions)
  - Настроить мониторинг production (Cloudflare Analytics, алерты)
  - Провести security review (базовая проверка)
  - Загрузить seed данные на production
- **Зависимости:** M5-INT-001, M5-QA-004
- **Критерии готовности:**
  - Production окружение настроено
  - Production деплой работает
  - Мониторинг настроен
  - Seed данные загружены

### Критерии готовности Milestone 5

- ✅ Все компоненты интегрированы и работают end-to-end
- ✅ Observability настроена (логирование, метрики, алерты)
- ✅ Тесты написаны и проходят (unit, contract, E2E)
- ✅ Ручное тестирование завершено, баги исправлены
- ✅ Документация актуальна
- ✅ Production окружение готово к релизу

---

## Общий Backlog (по приоритетам)

### P0 (критично, блокирует другие задачи)

**Backend:**
- M1-BE-001: Настройка монорепозитория
- M1-BE-002: Создание базовых пакетов
- M1-BE-003: Настройка OpenAPI-first процесса
- M1-BE-004: Создание API Gateway
- M1-BE-005: Настройка Neon PostgreSQL и миграций
- M2-BE-001: OpenAPI спецификация Auth Service
- M2-BE-002: Реализация Auth Service
- M2-BE-003: Интеграция Auth Service с API Gateway
- M2-BE-004: OpenAPI спецификация Content Service
- M2-BE-005: Реализация Content Service
- M2-BE-006: Интеграция Content Service с API Gateway
- M3-BE-001: OpenAPI спецификация Points Service
- M3-BE-002: Реализация Points Service
- M3-BE-003: Интеграция Points Service с другими сервисами
- M3-BE-004: OpenAPI спецификация Referral Service
- M3-BE-005: Реализация Referral Service
- M3-BE-006: Интеграция Referral Service с Auth Service
- M3-BE-007: Интеграция Referral Service с API Gateway

**Frontend:**
- M1-FE-001: Создание PWA Shell
- M4-FE-001: Улучшение PWA Shell
- M4-FE-002: Atlas UI Feature Capsule
- M4-FE-003: Pulse UI Feature Capsule
- M4-FE-004: Blog UI Feature Capsule
- M4-FE-005: Connect UI Feature Capsule
- M4-FE-006: Интеграция Frontend с Backend API

**DevOps:**
- M1-DEVOPS-001: Настройка CI/CD Pipeline
- M5-DEVOPS-001: Подготовка к Production

**Integration & Testing:**
- M5-INT-001: End-to-End интеграция
- M5-INT-002: Настройка Observability
- M5-QA-004: Ручное тестирование и баг-фиксы

### P1 (важно, но не блокирует)

**Backend:**
- M2-BE-007: Создание seed данных
- M2-BE-008: Настройка процесса загрузки seed данных

**Frontend:**
- M1-FE-002: Создание базовых UI компонентов

**Testing:**
- M5-QA-001: Unit тесты для Backend сервисов
- M5-QA-002: Contract тесты для API
- M5-QA-003: E2E тесты для критических потоков

**Documentation:**
- M5-DOC-001: Документация для разработчиков

---

## Зависимости между задачами

### Граф зависимостей (упрощённый)

```
M1-BE-001 (монорепозиторий)
  ├── M1-BE-002 (базовые пакеты)
  │   ├── M1-BE-003 (OpenAPI-first)
  │   │   ├── M2-BE-001 (Auth OpenAPI)
  │   │   ├── M2-BE-004 (Content OpenAPI)
  │   │   ├── M3-BE-001 (Points OpenAPI)
  │   │   └── M3-BE-004 (Referral OpenAPI)
  │   └── M1-BE-004 (API Gateway)
  │       ├── M2-BE-003 (Auth интеграция)
  │       ├── M2-BE-006 (Content интеграция)
  │       └── M3-BE-007 (Referral интеграция)
  ├── M1-BE-005 (Neon PostgreSQL)
  │   ├── M2-BE-002 (Auth Service)
  │   ├── M2-BE-005 (Content Service)
  │   ├── M3-BE-002 (Points Service)
  │   └── M3-BE-005 (Referral Service)
  └── M1-FE-001 (PWA Shell)
      ├── M1-FE-002 (UI компоненты)
      └── M4-FE-001 (PWA Shell улучшение)
          ├── M4-FE-002 (Atlas UI)
          ├── M4-FE-003 (Pulse UI)
          ├── M4-FE-004 (Blog UI)
          └── M4-FE-005 (Connect UI)

M2-BE-002 (Auth Service)
  ├── M2-BE-003 (Auth интеграция)
  ├── M3-BE-006 (Referral интеграция)
  └── M3-BE-003 (Points интеграция)

M2-BE-005 (Content Service)
  ├── M2-BE-006 (Content интеграция)
  └── M3-BE-003 (Points интеграция)

M3-BE-002 (Points Service)
  └── M3-BE-003 (Points интеграция)

M3-BE-005 (Referral Service)
  ├── M3-BE-006 (Referral интеграция)
  └── M3-BE-007 (Referral интеграция с Gateway)

M4-FE-002, M4-FE-003, M4-FE-004, M4-FE-005 (Feature Capsules)
  └── M5-INT-001 (E2E интеграция)
      ├── M5-QA-004 (Ручное тестирование)
      └── M5-DEVOPS-001 (Production готовность)
```

---

## Базовый тест-план

### Unit тесты

**Backend сервисы:**
- Points Service: начисление Points с проверкой лимитов, VIP коэффициенты, velocity limit
- Referral Service: генерация referral_code, создание реферальных связей, начисление бонусов
- Auth Service: обработка webhooks от Clerk, валидация JWT, проверка ролей
- Content Service: CRUD операции, поиск и фильтрация

**Frontend:**
- UI компоненты: рендеринг, пропсы, события
- Feature Capsules: изоляция, отсутствие межкапсульных импортов

### Contract тесты

**API endpoints:**
- Все GET endpoints (публичные и авторизованные)
- Все POST/PUT/DELETE endpoints (административные)
- Валидация входных данных (Zod схемы)
- Соответствие OpenAPI спецификации

### Integration тесты

**Межсервисные вызовы:**
- Auth Service → Points Service (начисление при регистрации)
- Content Service → Points Service (начисление при регистрации на событие)
- Referral Service → Points Service (начисление бонусов)
- Service JWT валидация

### E2E тесты

**Критические потоки:**
1. Регистрация пользователя → начисление Points → отображение в Connect
2. Регистрация по реферальной ссылке → начисление бонусов → отображение в Connect
3. Регистрация на событие → начисление Points → отображение в Connect
4. Просмотр контента (Atlas, Pulse, Blog) → офлайн-доступ
5. Просмотр баланса Points и истории транзакций

### Performance тесты

- Время загрузки страниц (< 3 секунд)
- API Response Time (p95 latency < 500ms)
- Офлайн-кэш (последние 20 мест, ближайшие события)

### Security тесты

- JWT валидация (User JWT и Service JWT)
- Проверка ролей (admin endpoints защищены)
- Rate limiting работает
- CORS настроен корректно

---

## Риски и митигация

### Технические риски

**Риск 1: Сложность интеграции Service JWT**
- **Вероятность:** Средняя
- **Влияние:** Высокое
- **Митигация:** Создать shared утилиты для генерации и валидации Service JWT в `packages/logger`

**Риск 2: Проблемы с синхронными вызовами (каскадные сбои)**
- **Вероятность:** Средняя
- **Влияние:** Высокое
- **Митигация:** Реализовать таймауты и graceful degradation с первого дня

**Риск 3: Недостаток seed данных для демонстрации**
- **Вероятность:** Низкая
- **Влияние:** Среднее
- **Митигация:** Создать seed данные на раннем этапе (M2-BE-007)

### Процессные риски

**Риск 4: Задержки в реализации из-за зависимостей**
- **Вероятность:** Средняя
- **Влияние:** Среднее
- **Митигация:** Чётко определить зависимости, начинать с независимых задач

**Риск 5: Несоответствие OpenAPI спецификации и реализации**
- **Вероятность:** Низкая
- **Влияние:** Среднее
- **Митигация:** OpenAPI-first процесс, contract тесты в CI

---

## Критерии готовности MVP

### Функциональные критерии

- ✅ Пользователь может просматривать контент в Atlas, Pulse, Blog
- ✅ Пользователь может зарегистрироваться и войти через Clerk SSO
- ✅ Пользователь может видеть баланс Points и историю транзакций
- ✅ Пользователь может пригласить друзей через реферальную программу
- ✅ Пользователь может зарегистрироваться на событие в Pulse
- ✅ Публичный контент доступен в офлайн-режиме

### Технические критерии

- ✅ Все микросервисы развёрнуты и доступны
- ✅ API Gateway маршрутизирует запросы корректно
- ✅ OpenAPI спецификация актуальна и типы генерируются автоматически
- ✅ CI/CD pipeline работает (lint, typecheck, build, deploy)
- ✅ Health checks всех сервисов возвращают 200 OK
- ✅ Логирование и метрики настроены

### UX критерии

- ✅ Навигация между модулями интуитивна
- ✅ Страницы загружаются быстро (< 3 секунд)
- ✅ Дизайн адаптивен для мобильных устройств
- ✅ Ошибки обрабатываются корректно (error boundaries, fallback UI)

---

## Deliverables

- ✅ План реализации MVP создан
- ✅ Работа разбита на 5 милстоунов
- ✅ Задачи распределены по ролям (Backend, Frontend, DevOps, QA)
- ✅ Зависимости между задачами определены
- ✅ Базовый тест-план создан
- ✅ Риски идентифицированы и митигированы

## Open Questions

Нет открытых вопросов. Все задачи определены на основе утверждённой архитектуры и ТЗ MVP.

## Next

Передача управления агенту **Planning Reviewer** для ревью плана реализации MVP.







