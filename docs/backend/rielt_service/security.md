# Rielt Service — Security

## Аутентификация

- JWT-токен от User Service (`Authorization: Bearer ...`).
- Публичные операции:
  - `GET /catalog`, `GET /catalog/map`, `GET /listings/{id}` (без контактов) доступны без токена.
- Все операции создания/изменения:
  - требуют авторизации.

## Авторизация

Роли (через claims в JWT):

- `user` — базовый пользователь:
  - может смотреть каталог,
  - создавать заявки,
  - добавлять в избранное,
  - в будущем — размещать ограниченное число объявлений.
- `pro` / `business_partner_owner`:
  - повышенные лимиты на количество объявлений,
  - расширенный функционал (описывается в бизнес-логике).
- `admin` / `moderator`:
  - могут смотреть и редактировать любые объявления,
  - управлять статусами,
  - просматривать любые заявки.

Проверка прав:

- Автор объявления:
  - может редактировать/архивировать только свои объявления.
- Заявки:
  - просмотр заявок по объявлению — только автор объявления и админ;
  - свои заявки — только сам пользователь.

## PII и контакты

- Контактные данные (телефон, email, мессенджеры) относятся к PII:
  - их видимость определяется `contact_policy` и бизнес-правилами (например, показывать только после регистрации/заявки).
- В логах:
  - не писать телефоны/email в явном виде.

## Rate limiting

- Создание/обновление объявлений:
  - ограничение по пользователю (анти-спам).
- Создание заявок:
  - ограничение по пользователю/объявлению (чтобы не заспамить одного арендодателя).

## Транспортная защита

- Внешние запросы — только HTTPS.
- Internal API — mTLS/Network policies (по мере усложнения инфраструктуры).

## Логи и аудит

- Логируются:
  - операции создания/обновления объявлений,
  - изменение статусов,
  - ключевые события по заявкам.
- Желателен `correlation_id` и `user_id` в логах (без PII).

