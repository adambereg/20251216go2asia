# Rielt Service — Основные сценарии (Workflows)

## 1. Размещение объявления арендодателем

1. Пользователь (владелец/агент) заходит в “Мои объявления”.
2. Нажимает “Создать объявление”.
3. Фронт:
   - при необходимости предлагает создать новый объект (`PropertyObject`) или выбрать существующий.
   - собирает форму `property + listing + contact_policy`.
4. Отправляет `POST /api/rielt/v1/listings`.
5. Rielt Service:
   - создаёт PropertyObject (если id не передан),
   - создаёт Listing со статусом `draft`.
6. Пользователь публикует объявление → `PATCH /listings/{id}` со `status = "published"`.

---

## 2. Поиск жилья арендаторами

1. Арендатор выбирает страну/город в Atlas или сразу в Rielt.
2. Фронт делает запрос:
   - `GET /api/rielt/v1/catalog?city_id=phu-quoc&listing_type=rent_long&min_price=...`.
3. Пользователь просматривает список, кликает на карточку:
   - `GET /listings/{id}`.
4. При каждом просмотре фронт может отправлять:
   - `POST /listings/{id}/view` (с rate limit).

---

## 3. Создание заявки на объявление

1. На карточке объявления пользователь выбирает “Откликнуться”.
2. Заполняет форму (даты, комментарий).
3. Фронт делает `POST /listings/{id}/requests`.
4. Rielt Service:
   - создаёт `TenantRequest` со статусом `new`.
   - через Notification Service уведомляет автора объявления.
5. Арендодатель в своём кабинете видит `my/listings/{id}/requests` и меняет статусы.

---

## 4. Управление избранным

1. Арендатор видит объявление и нажимает “Добавить в избранное”.
2. Фронт:
   - `POST /listings/{id}/favorite`.
3. Страница “Избранное”:
   - `GET /my/favorites` → список `listing_id`,
   - затем подтягивает карточки объявлений.

---

## 5. Архивация объявления

1. Объявление перестало быть актуальным (сдано/продано).
2. Автор или админ:
   - `PATCH /listings/{id}` со `status = "archived"` или `rented/ booked` (по бизнес-правилам).
3. Объявление:
   - перестаёт показываться в каталоге,
   - может отображаться в истории для автора.

---

## 6. Интеграция с RF и Atlas (пример)

1. Партнёр (Russian Friendly) создаёт объект/объявление через специальный партнёрский интерфейс.
2. RF Service присваивает объекту статус партнёрского и связывает с бизнес-профилем.
3. В Rielt Service устанавливается `is_partner_object = true`.
4. Atlas:
   - при отображении района/карты запрашивает `/catalog?city_id=...&is_partner_object=true` и рисует слой партнёрских объектов.

