# Logging & Analytics Service — Обзор

**Logging & Analytics Service** — централизованный слой наблюдаемости (Observability Layer) экосистемы **Go2Asia**.

Это не «классический» микросервис с бизнес-логикой, а **инфраструктурный контур**, объединяющий:

1. **Centralized Logging** — единая система логирования.
2. **Distributed Tracing** — распределённые трассировки запросов.
3. **Metrics & Alerting** — технические и бизнес-метрики + алерты.
4. **Analytics Events** — обезличенные события пользовательского поведения.

Вся серверная часть Go2Asia (Atlas, Pulse, Guru, Rielt, Voucher, RF, Quest, Referral, Connect, Points, NFT, Blockchain Gateway и т.д.) должна быть «прошита» через этот слой.

---

## Роль в экосистеме Go2Asia

Задача Logging & Analytics Service — дать:

- **разработчикам** — прозрачный взгляд на то, что происходит в каждом микросервисе;
- **DevOps** — метрики стабильности, производительности, алерты по деградации;
- **архитекторам** — картину сквозных трасс через десятки сервисов;
- **продуктовой команде** — обезличенную аналитику поведения пользователей;
- **безопасности** — security-логи и аномалии.

Этот сервис:

- ускоряет отладку (по correlation_id можно проследить путь запроса: BFF → Guru → Atlas → Rielt → Blockchain Gateway);
- позволяет быстро находить узкие места (по трассам и метрикам latency);
- формирует фундамент для бизнес-аналитики (через события аналитики).

---

## Четыре подсистемы внутри сервиса

### 1. Centralized Logging

- Все микросервисы пишут **структурированные JSON-логи**.
- Логи собираются через Log Collector и складываются в хранилище (ElasticSearch / ClickHouse / Loki — зависит от выбранного стека).
- В логах:
  - `service`, `level`, `timestamp`, `correlation_id`, `request_id`, `message`, `context`, `user_id?`, `error_stack`.

Ключевая идея: **никаких «просто строк в stdout»**, всё строго структурировано.

---

### 2. Distributed Tracing

- Используется стек уровня Jaeger / Tempo.
- Каждый внешний запрос получает **`trace_id`**, который прокидывается:
  - BFF → User → Connect → Voucher → Points → Blockchain Gateway и т.д.
- Каждый сервис создаёт **spans**:
  - входящий HTTP,
  - вызов БД,
  - вызов другого сервиса,
  - тяжёлые операции.

Это позволяет открыть трассу в Jaeger и увидеть полный маршрут запроса, время на каждом шаге и ошибки.

---

### 3. Metrics & Alerting

- Технические метрики:
  - latency, error rate, RPS, memory, CPU, queue length.
- Бизнес-метрики:
  - количество купленных ваучеров,
  - количество завершённых квестов,
  - количество рефералов,
  - выдача Points / NFT / G2A и др.

Метрики собираются через Prometheus (pull `/metrics` у сервисов), визуализируются в Grafana, алертинг идёт через Alertmanager.

---

### 4. Analytics Events

Отдельный поток **обезличенных событий**:

- `quest_completed`,
- `voucher_purchased`,
- `city_page_viewed`,
- `guide_opened`,
- `rf_partner_page_viewed`,
- и т.п.

Эти события:

- не содержат PII (email/телефон/ФИО и т.д.),
- используются для продуктовой аналитики и построения воронок,
- хранятся в отдельном аналитическом хранилище (чаще всего ClickHouse).

---

## Границы ответственности

Logging & Analytics Service:

- **НЕ** принимает бизнес-решений;
- **НЕ** влияет на токеномику;
- **НЕ** взаимодействует напрямую с пользователями;
- **Только** собирает и структурирует информацию о том, как работает платформа.

При этом он критичен для:

- быстрого реагирования на инциденты,
- анализа производительности,
- понимания, как реально используют платформу Go2Asia.
