# RF Service — Основные сценарии (Workflows)

## 1. Онбординг нового бизнес-партнёра через PRO

1. PRO-спейсер находит локальный бизнес и договаривается о партнёрстве.
2. PRO в интерфейсе Guru/RF создаёт черновик партнёра:
   - `POST /api/rf/v1/partners` с `onboarding_pro_user_id = current_user`.
3. Партнёр заполняет детали (через пригласительную ссылку) или PRO дополняет данные.
4. Админ проверяет информацию и выставляет `status = active`, назначает `rf_level`.
5. Партнёр появляется в каталоге Russian Friendly и на карте Atlas (через `atlas_place_id`).

---

## 2. Привязка ваучеров и премиум-ваучеров к партнёру

1. Админ или партнёр (через кабинет) создаёт ваучеры в **Voucher Service**.
2. После получения `voucher_id`:
   - вызывает `PATCH /api/rf/v1/partners/{id}/vouchers` с:
     - `default_voucher_ids` и/или `default_premium_voucher_ids`.
3. RF Service сохраняет ссылки.
4. На фронтенде карточка партнёра отображает:
   - какие ваучеры доступы (обычные / премиум),
   - базовые условия (подтягиваются из Voucher Service при необходимости).

---

## 3. Покупка Премиум-ваучера партнёра

1. VIP-спейсер открывает карточку партнёра.
2. Фронтенд:
   - получает данные партнёра из RF Service (`/partners/{id}`),
   - видит `default_premium_voucher_ids` и `economics` (награды G2A).
3. Пользователь нажимает “Купить Премиум-ваучер”.
4. BFF/Token Service:
   - запрашивает детали Премиум-ваучера в Voucher Service,
   - списывает G2A и (при необходимости) проверяет/изменяет NFT.
5. После успешной оплаты:
   - Token Service начисляет G2A-компенсацию бизнес-партнёру и PRO
     согласно `economics` из RF Service.
   - Voucher Service через internal API выпускает/привязывает Премиум-ваучер пользователю.
6. Пользователь видит Премиум-ваучер в своём списке ваучеров
   и может воспользоваться им при визите к партнёру.

---

## 4. Использование ваучера в заведении партнёра

1. VIP-спейсер приходит в заведение, заказывает товар/услугу.
2. На этапе оплаты:
   - показывает ваучер (QR/код) кассиру или вводит код в приложении.
3. Приложение партнёра (или RF-фронт) вызывает:
   - `POST /api/voucher/v1/validate` / `redeem` c контекстом партнёра (`partner_id`).
4. При успешном `redeem`:
   - RF Service об этом узнаёт через аналитику или события,
   - PartnerStats обновляется (увеличивается `total_vouchers_redeemed`).

---

## 5. Отзывы и социальный контент о партнёре

1. Пользователь после посещения партнёра пишет пост/отзыв в Space Asia.
2. Пост привязывается к `business_partner_id` и/или `atlas_place_id`.
3. Content/Reaction Service:
   - учитывает лайки/оценки,
   - агрегирует рейтинг.
4. RF Service периодически:
   - обновляет `PartnerStats.average_rating`, `total_reviews`
     по данным Content/Reaction.
5. Каталог RF показывает актуальный рейтинг и количество отзывов.

---

## 6. Деактивация партнёра

1. Если бизнес закрывается или нарушает правила:
   - админ ставит `status = suspended` или `archived`.
2. Партнёр перестаёт отображаться в публичном каталоге:
   - но его история (статистика и связи) сохраняется для отчётности.

