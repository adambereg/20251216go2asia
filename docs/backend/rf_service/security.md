# RF Service — Security

## Аутентификация

- Основной метод — JWT-токен от User Service:
  - `Authorization: Bearer <token>`.
- Для внутренних сервисов (internal API) возможен:
  - сервисный JWT с отдельной ролью (`service`),
  - mTLS (на более зрелых стадиях).

---

## Авторизация и роли

Основные роли (claims в токене):

- `user` — обычный пользователь:
  - доступ только к публичному каталогу (без авторизации) и к
    косвенным данным (например, “мои любимые партнёры” — в будущем).
- `pro` — PRO-спейсер:
  - может инициировать создание партнёра (черновик/pending_review);
  - может видеть список “своих” партнёров.
- `partner_owner` / `partner_manager`:
  - управляют данными партнёра и его точек;
  - могут привязывать ваучеры.
- `admin`:
  - полный доступ к данным и настройкам.

Проверки:

- `CreateBusinessPartner`:
  - `pro` или `admin`.
- `UpdateBusinessPartner`:
  - `partner_owner`/`partner_manager` этого партнёра или `admin`.
- Изменение `rf_level`, `status` → только `admin`.

---

## Безопасность данных

- RF Service не хранит платежные данные и токены G2A — только конфигурацию.
- Персональные данные:
  - контактные данные бизнес-партнёров могут включать личные телефоны/аккаунты,
  - логирование должно избегать хранения чувствительных PII в логах (маскирование телефонов и т.п.).

---

## Rate limiting

- Для публичного каталога:
  - мягкий rate limit по IP (защита от сканирования).
- Для операций управления:
  - более строгий limit per user/partner (защита от злоупотреблений API).

---

## Transport Security

- Внешний доступ — только по HTTPS.
- Internal-вызовы — внутри защищённой сети, возможен mTLS.

---

## Аудит

- Логировать:
  - создание/изменение партнёра,
  - изменения статусов/уровней,
  - изменения экономических параметров (особенно премиум-настроек).
- Журнал аудита должен позволять восстановить историю изменений для разрешения конфликтов и споров.
