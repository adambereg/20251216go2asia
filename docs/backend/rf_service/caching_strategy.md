# RF Service — Caching Strategy

## Цели кеширования

- Ускорить выдачу каталога Russian Friendly для популярных направлений (страна/город).
- Снизить нагрузку на БД при частых чтениях карточек партнёров.
- Обеспечить быстрый доступ к базовой информации о партнёре для других сервисов.

---

## Что кешируем

### 1. Каталог по популярным запросам

- Ключ: `rf:catalog:{country_id}:{city_id}:{hash(filters,sort,page,page_size)}`
- TTL: 1–5 минут (при небольшом трафике) или адаптивный.
- Источник истины — БД, кеш только ускоряет чтение.

### 2. Детальна карточка партнёра

- Ключ: `rf:partner:{id}`
- TTL: 1–10 минут.
- Инвалидируется при:
  - обновлении партнёра,
  - изменении точек,
  - изменении списка ваучеров/экономики.

### 3. Internal basic payload

- Ключ: `rf:internal:partner_basic:{id}`
- TTL: 5–30 минут.
- Используется Voucher/Points/Quest/Rielt и др. сервисами.

---

## Что не кешируем

- Чувствительные операции управления (create/update/delete).
- Статистику в реальном времени (PartnerStats) — может иметь собственный кеш/агрегации.

---

## Технология

- Redis как основной стор для кеша.
- PWA-фронтенд может дополнительно кешировать ответы на уровне браузера (HTTP cache),
  используя ETag/Last-Modified и `Cache-Control` заголовки.
