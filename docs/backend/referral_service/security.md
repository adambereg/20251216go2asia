# Referral Service — Security

## Аутентификация

- JWT от User Service:
  - `Authorization: Bearer <token>`.

---

## Авторизация

Роли:

- `user`, `vip`, `pro`, `admin`.

Права:

- `GET /my/links`, `POST /my/links`, `GET /my/stats`:
  - любой аутентифицированный пользователь.
- `POST /public/track-click/{code}`:
  - можно без токена (публичный endpoint), но с базовыми защитами и rate limiting.
- `/internal/*`:
  - только доверенные сервисы (сервисный JWT / API-ключ, сетевые ACL).
- `/admin/*`:
  - только пользователи с ролью `admin`.

---

## Безопасность данных

- Хранится:
  - реферальные связи, события, награды, агрегированная статистика.
- Не хранятся:
  - пароли, платежные реквизиты, приватные ключи.

---

## Rate limiting

- Для пользовательских endpoint’ов:
  - лимиты на создание ссылок и запрос статистики (защита от спама).
- Для `/public/track-click/{code}`:
  - лимиты по IP/устройству, защита от брутфорса и накруток.
- Для `/internal`:
  - лимиты per-service, логирование подозрительных паттернов.

---

## Аудит

- Логируются:
  - создание/обновление кампаний (`/admin/campaigns`),
  - внутренние события (`/internal/*`),
  - массовые изменения статуса наград.
