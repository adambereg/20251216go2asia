# Guru Service — Поиск и фильтрация

## Основная идея

Guru не делает полнотекстовый поиск по контенту, а:
- фильтрует и комбинирует результаты других сервисов,
- работает с простыми фильтрами (тип, теги, бюджет, RF, open_now).

## Фильтры в `/nearby`

1. **Гео**
   - `lat`, `lng`, `radius`.
   - Красная линия: не пытаться отдавать больше N объектов, даже если в базе их больше.

2. **Типы сущностей**
   - `types`: `place`, `event`, `housing`, `partner_venue`, `quest`.

3. **Время (для событий/квестов)**
   - `time_window`:
     - `now` — прямо сейчас,
     - `today` — до конца дня,
     - `tonight` — условно 18:00–23:59,
     - `weekend` — ближайшие выходные,
     - `upcoming` — ближайшие 48–72 часа.

4. **RF-фильтр**
   - `rf_only = true` — только объекты с флагом Russian Friendly.

5. **Open now**
   - `open_now = true`:
     - актуально для заведений (кафе, бар, ресторан, салон и т.п.),
     - Guru опирается на атрибуты из Atlas/RF (расписание).

6. **Budget**
   - `budget_level`: `low`, `medium`, `high`.
   - Маппится на:
     - `price_level` у мест,
     - `min_price`/`max_price` у событий/жилья.

7. **Теги**
   - `tags=coffee,beach,kids` — простая фильтрация на основе тегов, пришедших из источников.

## Сортировка

- `distance` (по умолчанию) — основная метрика.
- `rating` — вторичная: можно сортировать по формуле “distance + рейтинг”.
- `popular` — если источники предоставляют популярность (просмотры, лайки).
- `mixed` — кастомный алгоритм:
  - миксирует разные типы сущностей, чтобы выдача была более “живой”.

## Реализация фильтрации

- Базовые фильтры (по типу, расстоянию, RF, open_now) применяются уже в Guru.
- Часть фильтров может быть прокси в источники:
  - например, `time_window` прокидывается в Pulse,
  - `radius` — в Atlas/Pulse/Rielt и т.п.

Guru должен минимизировать объём данных по сети:
- просить у источников уже отфильтрованные/отсортированные данные,
- а не забирать тысячи объектов и фильтровать их локально (кроме крайних случаев).

## Поиск по названию (Фаза 2)

Если потребуется быстрый поиск по названию “рядом”:
- либо фронт использует существующий поиск в Atlas/поисковом движке,
- либо Guru делегирует поиск в отдельный Search Service (когда он появится),
  комбинируя поиск с гео-фильтром.

Guru не должен превращаться в ещё один большой поисковый движок.
