# Guru Service — Безопасность и доступ

## Аутентификация

- Публичные эндпоинты:
  - `/nearby`, `/nearby/places`, `/nearby/events`, `/what-to-do`
  - могут работать без JWT (гостевой режим).
- Персонализированные эндпоинты:
  - `/preferences/me`, `/history`, `/saved`
  - требуют JWT от User Service.

## Авторизация

В Guru довольно простой пермишен-модель:

- Любой авторизованный пользователь может управлять **только своими**:
  - preferences,
  - history,
  - saved entities (если будут реализованы).
- Межсервисные вызовы (например, админский `/internal/rebuild-cache`) защищены:
  - сервисным JWT или mTLS (“внутренний” доверенный трафик).

## Защита от злоупотреблений

- Rate-limiting на:
  - `/nearby` и `/what-to-do` по IP/пользователю,
  - чтобы не допустить DDoS стиль “крутильщиков карты”.
- Лимиты на `radius`, `page_size`, количество типов и т.п.

## Логирование и аудит

- Логируются:
  - параметры ключевых запросов `/nearby` (без PII, только гео, радиус, фильтры),
  - ошибки интеграций,
  - действия по изменению preferences.
- Использование `correlation-id` для трейсинга запросов между сервисами.

## Конфиденциальность

- Guru не хранит чувствительных данных:
  - prefs носят поведенческий характер (интересы/профиль путешествий),
  - saga с PII (имя, email) — в User Service, а не в Guru.
- Геоданные:
  - “сырые” координаты не логируются помеченными как PII (по возможности),
  - можно округлять/анонимизировать записи для аналитики.
 - управление флажком “показывать в Guru” осуществляется в User/Space, а Guru доверяет только этому источнику
