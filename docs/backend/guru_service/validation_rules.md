# Guru Service — Правила валидации

## Параметры гео

- `lat`:
  - обязательный, float,
  - -90 … 90.
- `lng`:
  - обязательный, float,
  - -180 … 180.
- `radius`:
  - int, > 0,
  - по умолчанию 3000,
  - максимум, например, 20000 (чтобы не ломать производительность).

## Типы и фильтры

- `types`:
  - список допустимых значений:
    - `place`, `event`, `housing`, `partner_venue`, `quest`.
  - если список пустой → берём все.
- `time_window`:
  - только из предопределённого набора.
- `budget_level`, `travel_profile`:
  - только из документов/енумов, зарегистрированных в Guru.

## Параметры пагинации

- `page`:
  - >= 1;
- `page_size`:
  - по умолчанию 50,
  - максимум 100.

## Preferences

При `PUT /preferences/me`:

- `language`:
  - поддерживаемые коды, напр. `ru`, `en`.
- `home_city_id`:
  - формально не обязательно валидировать синхронно через Atlas (для MVP),
  - но желательно иметь фоновые проверки/очистку.
- `interests`:
  - ограничить список длиной (не более, например, 50 элементов),
  - каждый интерес — из белого списка или хотя бы не слишком длинная строка.

## Ошибки интеграций

- Если один из источников (Atlas, Pulse, и т.п.) отвечает ошибкой/таймаутом:
  - Guru **не падает** с 500,
  - логирует проблему, но отдаёт остальные результаты.
- При явной ошибке в параметрах (например, невалидный `lat`/`lng`):
  - возвращать 400 с понятным описанием.

## Безопасность параметров

- Всё, что уходит в запросы к другим сервисам, проходит нормализацию и escaping.
- Guru не передаёт никакие “сырые” параметры от клиента во внутренние SQL/поиски без валидации.

## Проверки

- тип guru разрешён только если он пришёл из доверенного источника (User/Space),
- visible_in_guru может быть только у пользователей с ролью PRO,
- languages, specialties — ограничение по длине/списку.