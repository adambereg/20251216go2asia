# Quest Service — Security

## Аутентификация

- JWT от User Service:
  - `Authorization: Bearer <token>`.

---

## Авторизация

Роли:

- `user` — базовая роль.
- `vip` — может покупать квесты.
- `pro` — может создавать/редактировать квесты (в рамках своих).
- `admin` — модерация, управление всеми квестами.

Права:

- `GET /catalog/quests`, `GET /quests/{id}` — публично (без токена, опционально).
- `POST /runs` — только для `vip` и выше.
- `GET /runs/my` и `GET /runs/{id}` — только владелец или участники.
- `POST /quests` / `PATCH /quests/{id}` / `PUT /quests/{id}/steps`:
  - `pro` — только для своих квестов;
  - `admin` — для всех.
- `POST /quests/{id}/publish`:
  - `admin` (минимально на MVP).

---

## Безопасность данных

- Quest Service не хранит:
  - финансовые реквизиты,
  - токены G2A,
  - чувствительные медиа-файлы (только `media_id`).
- GPS-данные и ответы на вопросы:
  - используются только для геймификации и не должны передаваться третьим сторонам.

---

## Rate limiting

- Покупка квестов (`POST /runs`) и отправка чекпоинтов:
  - защищены rate limit per-user для предотвращения спама.
- Admin/PRO операции:
  - отдельный лимит, логирование для аудита.

---

## Аудит

- Логируются:
  - создание/изменение квестов,
  - публикация/архивация,
  - покупки квестов,
  - завершение и выдача наград.
