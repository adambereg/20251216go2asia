# Content Service — Caching Strategy

## Цели кеширования

- Снять нагрузку с БД для популярных:

  - постов (часто просматриваемые),
  - контекстных лент (по популярным местам/событиям).

---

## Что кешируем

### 1. Популярные посты по ID

- Ключ: `content:post:{id}`
- Значение: сериализованный пост + базовые поля (без тяжёлых вложенностей).
- TTL: 5–15 минут.
- Инвалидация:
  - при обновлении/удалении поста.

### 2. Контекстные ленты (`/feed/context`)

- Ключ:
  - `content:feed:context:{module}:{context_entity_id}:{type}:{page}`
- Значение:
  - список `post_id`, метаданные.
- TTL: 1–5 минут для очень активных контекстов, 15–30 минут для менее популярных.
- Инвалидация:
  - при добавлении/удалении поста в данном контексте.

### 3. User feed (опционально, после MVP)

- Можно кешировать первые страницы `/feed/user/{user_id}`.

---

## Что НЕ кешируем

- Сырые тексты жалоб (`ContentReport`).
- Внутренние модерационные статусы в явном виде в публичном кеше (можно кешировать, но аккуратно).
- Полные деревья комментариев для очень больших постов (лучше странично и осторожно).

---

## Reactions и кеш

- Реакции (лайки) могут кешироваться отдельно в Reactions Service.
- Content Service может:
  - либо запросить реакций для набора `post_id` и совместить в ответе,
  - либо отдать фронту `post_id`, а фронт сам дергает Reactions Service.

---

## Технология

- Redis/value-кеш.
- TTL-based стратегия, без сложных инвалидаций на первом этапе, кроме явных сбросов при обновлениях.
