# Notification Service — Обзор

## Назначение

**Notification Service** — централизованный микросервис для отправки уведомлений
пользователям Go2Asia через разные каналы:

- push (мобильные и веб-push, например OneSignal/FCM/APNs),
- email (через Postbox/Mailgun/другие провайдеры),
- (Фаза 2) Telegram Bot API,
- (Фаза 2) внутренняя «уведомительная лента» в Space Asia.

С учётом новой модели реакций и асинхронного общения:

- в экосистеме **нет классических чатов и комментариев**,
- **Reactions Service** и Thread/Inquiry Model генерируют события общения,
- **Notification Service** становится ключевым транспортным слоем коммуникации:
  он доставляет пользователям сигналы о событиях, реакциях, ответах и системных изменениях.

## Основные задачи

1. **Подписка на события Event Bus**
   - `reaction.created` — лайки, отзывы, репосты, вопросы, запросы контакта, ответы в ветках.
   - `thread.reply.created` — новые сообщения в ветке общения.
   - `quest.completed`, `voucher.redeemed`, `points.awarded`, `badge.earned`.
   - `user.registered`, `user.password_reset`, `user.email_confirm_required`.
   - `post.published`, `space.followed`, `rf_partner.approved` и др.

2. **Формирование и отправка уведомлений**
   - выбор канала (push/email/telegram/внутренняя лента),
   - подстановка данных по шаблону,
   - учёт локали и языка пользователя.

3. **Управление предпочтениями (Фаза 2)**
   - включение/отключение типов уведомлений,
   - выбор предпочтительных каналов,
   - тихие режимы (nocturnal quiet hours).

4. **Логирование и аналитика**
   - хранение записей об отправленных уведомлениях,
   - статусы доставки (queued, sent, delivered, opened, failed),
   - базовая статистика (CTR, частота отправки по типам).

## Роль в архитектуре Go2Asia

Notification Service:

- снимает с других микросервисов ответственность за:
  - выбор канала,
  - форматирование сообщений,
  - ретраи и троттлинг,
- обеспечивает единый **notification-слой** поверх:
  - Reactions Service,
  - User Service (регистрация/сброс пароля),
  - Connect / Points / NFT / Token Service (награды),
  - Quest Service,
  - Rielt Service,
  - RF Service,
  - Atlas / Pulse / Blog / Guru и др.

Таким образом, любые изменения в схемах отправки уведомлений и новых каналах
делаются централизованно, без изменения логики доменных сервисов.
