# Voucher Service — Caching Strategy

## Цели кеширования

- Минимизировать обращения к БД при частой проверке промокода.
- Ускорить `validate` для популярных ваучеров/кампаний.

---

## Что кешируем

### 1. Ваучер по коду

- Ключ: `voucher:code:{code}`
- Значение:
  - основные поля `Voucher` (status, type, value, сроки, лимиты).
- TTL:
  - 1–5 минут (для активных кампаний),
  - либо до ближайшего изменения (инвалидация при PATCH).

Использование:

- `validate` сначала проверяет кеш по `code`,
- при промахе — обращается к БД и кладёт результат в кеш.

### 2. Ваучер по id

- Ключ: `voucher:id:{id}` — для внутренних вызовов.

---

## Что не кешируем

- Суммарное количество погашений и лимит на пользователя:
  - вычисляется на основе таблицы `VoucherRedemption`.
  - При высокой нагрузке можно добавить отдельные счётчики/агрегации.

---

## Идемпотентность и кеш

- Операция `redeem` не может опираться только на кеш:
  - фактическое списание лимита нужно делать в транзакции в БД.
- Кеш можно использовать **только для предварительной фильтрации** и ускорения ошибок (expired/inactive).

---

## Технология

- Redis как основной инструмент для кеша по `code`.
- Возможный future enhancement:
  - отдельный “in-memory” слой на API-нодах для горячих кодов.
