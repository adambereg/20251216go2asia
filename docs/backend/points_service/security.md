# Points Service — Security

Points Service управляет экономической ценностью (баллами), поэтому требования к безопасности высокие.

## 1. Аутентификация

- Все endpoint’ы Points Service — **внутренние**.
- Доступ к `/internal/*`:
  - только по **service-to-service** аутентификации (JWT сервисов, mTLS, внутренняя сеть).
- Пользовательские JWT-токены **не принимаются напрямую**.

Список доверенных сервисов (MVP):

- `connect_service` (начисления),
- `quest_service` (покупки квестов),
- `voucher_service` (ваучеры),
- `rielt_service` (бронирования),
- возможно, другие при явном расширении.

## 2. Авторизация

Для каждого сервисного клиента:

- на уровне конфигурации задаётся, какие операции разрешены:
  - `connect_service`:
    - может вызывать только `credit`,
  - `quest_service`:
    - `debit`, `hold`, `release`, `capture`,
  - `voucher_service`:
    - `hold`, `release`, `capture`, возможно `debit` в спецкейсе.

Это предотвращает:

- прямое начисление Points обходя Connect,
- злоупотребления на стороне доменных сервисов.

## 3. Логирование и аудит

- Логируются:
  - все API-вызовы (method, path, caller_service, status),
  - все операции с транзакциями и холдами,
  - все ошибки валидации и доступа.
- Можно дополнительно:
  - отправлять события аудита в отдельный Logging/Audit Service.

## 4. Защита от злоупотреблений

На уровне MVP:

- жесткие правила доступа по `source_service` и endpoint’ам,
- идемпотентность на `external_id`.

На следующих этапах:

- лимиты для каждого `source_service` (например, сколько `credit` он может инициировать за сутки),
- интеграция с Anti-Fraud.

## 5. Надёжность и отказоустойчивость

- При внутренних ошибках (БД, время ответа) операции **не должны** частично применяться.
- Клиентам возвращаются:
  - либо явные ошибки, либо чёткие статусы.
- Идемпотентность позволяет безопасно повторять запросы.
