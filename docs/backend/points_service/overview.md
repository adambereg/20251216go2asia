# Points Service — Обзор

## Назначение

**Points Service** — это специализированный микросервис-ледгер, который отвечает за:
- учёт всех офчейн-баллов (**Points**) в экосистеме Go2Asia;
- гарантированно корректное изменение балансов пользователей;
- ведение неизменяемого журнала всех операций (append-only ledger);
- предоставление точного текущего баланса и истории транзакций.

Points Service **не принимает бизнес-решений**, кому и сколько начислять — этим занимается **Connect Service**.
Его задача — строго и надёжно исполнить команды:

- начислить Points (`credit`),
- списать Points (`debit`),
- временно заморозить сумму (`hold`),
- освободить холд (`release`).

В дальнейшем Points Service может поддерживать и другие офчейн-валюты (например, `g2a_offchain`), но в рамках MVP:
- основная валюта — `points`,
- ончейн-часть (настоящий G2A в блокчейне) обслуживается отдельно через **Blockchain Gateway Service**.

## Основные свойства

- **Единый источник истины (Single Source of Truth)** для офчейн Points:
  - никакой другой сервис не имеет права изменять балансы напрямую;
  - все изменения идут через транзакции Points Service.
- **ACID-семантика**:
  - каждая операция либо применяется полностью, либо не применяется вовсе;
  - нет «подвисших» половинчатых изменений баланса.
- **Идемпотентность**:
  - по `external_id` защищается от повторной обработки одной и той же командной операции,
  - особенно критично при интеграциях и повторных HTTP/Queue-доставках.
- **Полный аудит**:
  - любой баланс можно восстановить суммированием транзакций;
  - все операции привязаны к источнику (`source_service`, `source_event_id`, `reason`).

## Границы ответственности

Points Service:

- **отвечает** за:
  - хранение и изменение балансов Points,
  - регистрацию транзакций и холдов,
  - предоставление баланса и истории по запросу,
  - базовые валидации (например, не списать больше, чем есть).
- **не отвечает** за:
  - определение правил наград (что, за что и в каком объёме) — это Connect Service,
  - логистику ончейн-валют и NFT — это Blockchain Gateway и NFT Service,
  - расчёт реферальных многослойных схем — это Referral + Connect.

Points Service — это «бухгалтерия Points» во всём Go2Asia.
