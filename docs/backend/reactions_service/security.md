# Reactions Service — Security

## Аутентификация

- Все пользовательские endpoint’ы:
  - JWT-токен: `Authorization: Bearer <token>`.
- Internal / service endpoint’ы:
  - сервисные токены (service JWT / API key),
  - сетевые ограничения (VPC / IP allowlist).

---

## Авторизация

Роли:

- `user`, `vip`, `pro`, `rf_partner`, `host`, `moderator`, `admin`.

Основные правила:

- `POST /reactions`:
  - для всех аутентифицированных пользователей.
- `DELETE /reactions/{id}`:
  - автор реакции может скрыть её для себя (`hidden_by_user`);
  - модератор/админ может скрыть глобально (`hidden_by_moderator` / `deleted`).
- `GET /reactions/list`, `POST /stats/batch`, `GET /stats`:
  - общие endpoint’ы (для фронтенда и других микросервисов) — с аутентификацией, но без особых ограничений ролей.
- `GET /threads`, `GET /threads/{id}`:
  - доступ только к веткам, где пользователь является `initiator` или `target` (или модератор/админ).
- `/reports`:
  - жалобы могут создавать все пользователи;
  - просмотр/обработка — только модераторы/админы.

---

## Безопасность данных

- Сервис хранит:
  - текстовые поля (отзывы, вопросы, ответы в ветках),
  - ассоциированные метаданные.
- Не хранит:
  - пароли, платёжные данные, приватные ключи.

Для текстового контента:

- возможна интеграция с Moderation/Trust & Safety:
  - фильтрация токсичных/опасных содержаний,
  - блокировка нежелательного контента.

---

## Защита от злоупотреблений

- Rate limiting по:
  - IP,
  - user_id,
  - типу реакции.
- Антифрод-паттерны:
  - массовые лайки/рейтинги на одного партнёра,
  - волны реакций с одинаковыми payload.

---

## Логирование и аудит

- Логируются:
  - создание и удаление реакций,
  - изменения статусов (модерация),
  - создание/закрытие веток общения,
  - жалобы (reports).
