# Pulse Service — Поиск и фильтрация событий

## Цели поиска

- Быстро находить **актуальные предстоящие события** по городу/региону.
- Отображать **архив** с богатой фильтрацией по дате, типу, месту.
- Поддерживать **поиск для Guru/Quest/Blog** по ограниченным критериям.

## Базовые фильтры

1. **География**:
   - `country_id` — список событий по стране;
   - `city_id` — основной фильтр для Pulse Asia;
   - `place_id` — события в конкретной локации (бар, клуб, пляж).

2. **Время**:
   - пресеты:
     - `mode=today`
     - `mode=tomorrow`
     - `mode=weekend`
     - `mode=upcoming`
     - `mode=past`
   - произвольный диапазон:
     - `date_from`, `date_to`.

3. **Категории и теги**:
   - `category_id` (один или несколько, через запятую);
   - `tags` (поиск по набору тегов).

4. **Стоимость**:
   - `free_only=true` — только бесплатные;
   - (Фаза 2) `price_min`, `price_max`.

5. **Тип и источник**:
   - `rf_only=true` — только события от RF-партнёров;
   - `organizer_type` — `pro`, `partner`, `editorial`.

6. **Текстовый поиск**:
   - `q` — поиск по:
     - `title`
     - `subtitle`
     - `description_short`
     - базовые теги.

## Сортировка

- `sort=starts_at_asc` (по умолчанию) — ближайшие события выше.
- `sort=starts_at_desc` — события, ближайшие к текущему времени в обратном порядке (для архива).
- (Фаза 2) `sort=popular` — по популярности/посещаемости.

## Реализация поиска

### MVP (v1)

- Использование индексов БД:
  - `city_id`, `starts_at`, `status`, `category_id`.
- Поиск по `q`:
  - ILIKE (`%q%`) по `title` и `description_short` для начала.

### Расширенный поиск (Фаза 2–3)

- Вынесение поиска в отдельный движок:
  - Meilisearch / OpenSearch:
    - индекс событий с полями:
      - текстовые (title, subtitle, descriptions, tags);
      - фильтруемые (city_id, country_id, category_id, is_free, rf_badge);
      - сортируемые (starts_at, популярность).
- Pulse при изменении события:
  - публикует событие в поисковый индекс.

## Особенности фильтрации для Guru

Для `GET /events/nearby`:

- фильтры более жёсткие:
  - только `published`;
  - только `upcoming` (например, в ближайшие 48–72 часа);
  - ограничение `limit` (не более 50–100 событий за раз);
- сортировка по расстоянию, затем по времени.
