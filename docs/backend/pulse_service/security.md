# Pulse Service — Безопасность и доступ

## Аутентификация

- Все небезопасные операции (create/update/publish/cancel) требуют JWT от User Service.
- Публичные `GET /events` и `GET /events/{id}` доступны без токена.
- Внутренние интеграции между сервисами защищены:
  - mTLS;
  - проверка сервисных ролей для доступа к определённым эндпоинтам.

## Авторизация и роли

Типы ролей (получаются из JWT):

- `user` — обычный пользователь:
  - не может создавать события (на MVP);
  - (Фаза 2) может предлагать события → создаются как `draft` + модерация.
- `pro` — PRO-организатор:
  - может создавать свои события;
  - редактировать их до и после публикации (с ограничениями).
- `partner` — бизнес-партнёр RF:
  - может создавать события, привязанные к своему заведению;
  - не может менять чужие события.
- `editor` — редакция Go2Asia:
  - может создавать/редактировать/публиковать любые события;
  - может менять флаг `featured`.
- `admin` — полные права.

Авторизационные правила:

- `POST /events` — `pro`, `partner`, `editor`, `admin`.
- `PATCH /events/{id}` — владелец события (pro/partner) или `editor/admin`.
- `POST /events/{id}/publish` — `editor/admin` (и, опционально, `pro` в доверенных режимах).
- `POST /events/{id}/cancel` — владелец + `editor/admin`.

## Валидация входных данных

- Использование централизованных схем (например, Zod/Yup/JOI) для DTO.
- Защита от:
  - SQL-инъекций (через ORM и параметризованные запросы);
  - XSS (все HTML-поля либо запрещены, либо проходят санитайзинг на контентном уровне).

## Логирование и аудит

- Логируются:
  - создание/обновление/публикация/отмена событий;
  - ошибки авторизации/валидации.
- `correlation-id` — во всех запросах, для трассировки цепочек между сервисами.

## Ограничение частоты (Rate Limiting)

(Фаза 2)

- Ограничение на число запросов:
  - на создание/изменение событий на пользователя/час;
  - на запросы к публичным эндпоинтам (`GET /events`), чтобы защититься от DDoS-подобной активности.

## DDoS и устойчивость

- Базовая защита на уровне API Gateway / WAF.
- Pulse спроектирован так, чтобы:
  - при резком росте нагрузки масштабироваться горизонтально;
  - при падении внешних сервисов (Atlas/Connect) продолжать отдавать базовые данные (read).
