# Pulse Service — Правила валидации

## Общие правила

- Все операции создания/редактирования событий проходят через:
  - валидацию схем (DTO);
  - бизнес-валидацию (логические ограничения).

## Обязательные поля при создании события

- `title` — не пустое, длина 3–200 символов.
- `description_short` — 10–500 символов.
- `category_id` — должен существовать в справочнике категорий.
- Время:
  - `starts_at` — в будущем (с учётом небольшой погрешности, можно разрешить создание событий “прямо сейчас”).
- Локация:
  - либо `place_id` (офлайн событие),
  - либо `is_online=true` и `online_url` не пустой.

## Валидация времени

- Если `ends_at` указано:
  - `ends_at > starts_at` (как минимум +1 минута).
- Нельзя перевести событие в `published`, если:
  - `starts_at` уже в прошлом (или слишком близко, если политика не позволяет).

## Категории и теги

- `category_id`:
  - должен быть из списка `EventCategory`.
- `tags`:
  - допустимый набор символов;
  - длина каждого тега, например, до 32 символов;
  - не более N тегов (например, 10).

## Геоданные и связи

- `country_id`, `city_id`:
  - проверка через Atlas (Фаза 2 — можно доверять данным из фронта, если они приходят от Atlas UI).
- `place_id`:
  - при создании/обновлении:
    - Pulse запрашивает Atlas (`GET /places/{id}`), убеждается, что место существует и привязано к тому же `city_id`.

## Организатор

- `organizer_user_id`:
  - должен быть действительным пользовательским ID (User Service).
- Для PRO-событий:
  - токен пользователя должен иметь роль PRO.
- Для партнёрских событий:
  - `organizer_partner_id` должен принадлежать текущему пользователю (PRO-куратору или представителю партнёра).
- `rf_badge`:
  - может быть true только если событие связано с RF-партнёром.

## Публикация и статусы

Переходы статусов:

- `draft` → `published`:
  - все обязательные поля корректны;
  - время в будущем.
- `published` → `cancelled`:
  - допустимо в любой момент;
  - желательно указать причину (Фаза 2).
- `published` → `finished`:
  - только системой (джоб по времени).
- `draft` → `cancelled`:
  - для неиспользуемых заготовок.

## Ограничения по длинам и форматам

- `title`: до 200 символов.
- `subtitle`: до 200 символов.
- `description_short`: до 500 символов.
- `description_full`: до 20 000 символов (text).
- `online_url`: валидный URL.
- `currency`: 3 символа ISO-кода (например, `VND`, `THB`).

## Антиспам/модерация (Фаза 2)

- Лимит событий на пользователя/партнёра за период.
- Автоматические правила:
  - запрет на “всевременные” события (слишком длинные по длительности);
  - анти-NSFW фильтрация текста (на уровне AI/модерации).
