# Atlas Service — Security

## Аутентификация

- Все защищённые эндпоинты (создание/обновление мест, админ-функции) требуют:
  - JWT токен от User Service;
  - проверку подписи и срока действия токена. :contentReference[oaicite:13]{index=13}  

## Авторизация

Роли (минимальный набор):

- `anonymous` — неавторизованный пользователь:
  - доступ только к публичным `GET` (список стран/городов, список мест, детали места) — на усмотрение продукта.
- `user` — базовый зарегистрированный пользователь:
  - только чтение Atlas;
  - возможно, отправка заявок на новое место (через отдельный UGC endpoint).
- `ugc_pro` / `pro`:
  - создание черновиков мест;
  - редактирование своих черновиков до модерации.
- `atlas_editor`:
  - полный доступ к CRUD мест, кроме критичных админ-операций.
- `admin`:
  - полный доступ ко всем операциям Atlas;
  - служебные операции (архивирование, миграции и т.п.).

Проверка ролей — на application уровне, через claims в JWT.

## Ограничение запросов (Rate Limiting)

- Публичные search/nearby эндпоинты:
  - имеют rate limiting по IP/пользователю, чтобы предотвратить scraping и DDoS.
- Admin/API для записи:
  - ограничены ещё жёстче, доступны только определённым ролям и из доверенной сети (опционально — дополнительный IP allowlist).

## Защита данных

- Атрибуты, связанные с персональными данными (почти отсутствуют в Atlas):
  - Atlas не хранит PII, кроме ID пользователей-редакторов (`created_by_user_id` / `updated_by_user_id`).
- Логи:
  - не должны содержать чувствительные данные;
  - только техническую информацию (ID, координаты, ID пользователей без контента).

## Транспортная безопасность

- Взаимодействие между сервисами:
  - через HTTPS или mTLS внутри кластера.
- Внешний доступ (если Atlas публичен):
  - только по HTTPS.

## Интеграции (RF, Pulse, Rielt, Quest и др.)

- Вызовы internal API Atlas из других сервисов могут дополнительно:
  - использовать сервисные учётные данные (machine-to-machine auth);
  - иметь отдельные scopes (например, `service:pulse` с ограниченным набором эндпоинтов).

## Защита от злоупотреблений UGC

- Ограничение на число UGC-заявок от одного пользователя в день.
- Soft-модерация:
  - все UGC-места проходят модерацию;
  - автоматические проверки (спам, дубликаты, некорректные координаты).

## Backoffice и админка

- Admin UI для Atlas:
  - доступен только через VPN или защищённый контур;
  - дополнительная авторизация (2FA для админов).

