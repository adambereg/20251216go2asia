# Blockchain Gateway Service — Обзор

## Роль в экосистеме Go2Asia

**Blockchain Gateway Service** — критический инфраструктурный микросервис Go2Asia, отвечающий за безопасное взаимодействие всей платформы с блокчейном **TON**.

Он является единственной точкой входа для всех on-chain операций:

- с токеном **G2A** (hard‑currency экосистемы),
- с on-chain **NFT-бейджами** (часть репутации и достижений),
- с внешними TON-кошельками пользователей.

Gateway выступает мостом между:

- оффчейн‑слоем (Points, Connect, NFT Service, Referral, Quest, RF, Rielt),
- ончейн‑слоем (TON, смарт‑контракты токена G2A и NFT‑коллекций).

## Основные задачи

1. **Исполнение токен-операций с G2A**
   - `mint` — выпуск G2A в TON по запросу Connect/Points.
   - `burn` — сжигание G2A при обратной конверсии/технических операциях.
   - `transfer` — вывод G2A с кастодиального кошелька платформы на внешний адрес пользователя.

2. **Исполнение NFT-операций**
   - `mint` NFT-бейджей, выпущенных NFT Service в ончейн‑формате.
   - `upgrade` (реализуется как `burn + mint`) при повышении уровня бейджа.
   - `burn` — опционально для отзыва или миграции NFT.

3. **Отслеживание статуса транзакций**
   - Создание задач `BlockchainTask` для каждой операции.
   - Отправка транзакций в сеть TON.
   - Мониторинг подтверждений через TonAPI/tonlib.
   - Отправка callback’ов инициирующим сервисам (Connect/NFT/Points).

4. **Привязка TON-кошельков пользователей (wallet linking)**
   - Генерация `challenge` для подписи.
   - Проверка подписи и валидация владения адресом.
   - Хранение связки `user_id ↔ ton_address`.

5. **Безопасность и управление ключами**
   - Хранение приватных ключей платформы (minter, custody, nft-minter) в HSM/secure vault.
   - Подпись всех транзакций внутри безопасного модуля.
   - Ограничение доступа к сервису только для внутренних микросервисов.

## Границы ответственности

**Blockchain Gateway Service:**

- **ДЕЛАЕТ:**
  - принимает формализованные команды от внутренних сервисов,
  - проверяет базовую валидность параметров,
  - создаёт и ведёт задачи on-chain операций,
  - подписывает и отправляет транзакции,
  - отслеживает подтверждения,
  - сообщает инициатору итоговый статус.

- **НЕ ДЕЛАЕТ:**
  - не принимает бизнес‑решений «кому и сколько начислить»,
  - не управляет балансами Points и оффчейн G2A,
  - не решает, кому выдавать NFT — только исполняет команды от NFT Service,
  - не взаимодействует напрямую с конечными пользователями (нет публичного API).

Все решения о наградах принимаются на уровне **Connect Service**, а Gateway — это «руки», выполняющие их в TON.

## Почему выделен в отдельный микросервис

- Максимизация безопасности и изоляция приватных ключей.
- Локализация блокчейн‑логики в одном месте.
- Возможность развития / замены блокчейн‑стека без влияния на бизнес‑логику.
- Чёткая грань ответственности: бизнес‑сервисы ≠ блокчейн‑сервис.
