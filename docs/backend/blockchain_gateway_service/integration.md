# Blockchain Gateway Service — Integrations

## 1. Connect Service

Connect — главный «оркестратор экономики».

- Отправляет:
  - `g2a/mint`,
  - `g2a/transfer`,
  - иногда `g2a/burn` (если бизнес‑логика требует).
- Получает:
  - статусы задачи (pull),
  - callback (push), если реализуем обратную интеграцию.

Пример сценария:

1. Пользователь прошёл эпический квест.
2. Connect начисляет Points и решает выдать on-chain G2A.
3. Connect → `POST /g2a/mint`.
4. Gateway создаёт задачу, выполняет транзакцию, сообщает результат обратно Connect.

---

## 2. Points Service

Points Service:

- отвечает за оффчейн баллы,
- может взаимодействовать с G2A для взаимной конверсии:
  - при «обмене G2A на Points» инициировать `g2a/burn`.

---

## 3. NFT Service

NFT Service:

- хранит оффчейн NFT-бейджи,
- вызывает:
  - `/nft/mint` — при необходимости ончейн‑репрезентации бейджа,
  - `/nft/upgrade` — при повышении уровня бейджа, когда требуется обновить ончейн‑статус.

После callback’а от Gateway:

- NFT Service обновляет `onchain_status` и `onchain_token_id` для соответствующего NFTInstance.

---

## 4. User Service / BFF

Использование:

- `/wallet/link/request` — инициировать привязку адреса,
- `/wallet/link/confirm` — подтверждать владение адресом подписью.

User Service/BFF отвечает за:

- UX,
- сбор подписи на стороне пользователя,
- отображение состояния привязки в личном кабинете.

---

## 5. Admin / Backoffice

Админские сценарии:

- Просмотр списка BlockchainTask (фильтрация по статусу, пользователю, типу).
- Проверка зависших задач (`pending`/`sent`, без подтверждения слишком долго).
- Просмотр состояния ноды TON и системных кошельков.

---

## 6. TON инфраструктура

Варианты:

- TonAPI,
- собственный full node,
- tonlibjson/lite-client.

Gateway интегрируется:

- для отправки транзакций,
- для чтения их статуса,
- для получения информации о блоках.

Важно предусмотреть:

- смену провайдеров TonAPI,
- резервный доступ к ноде.
