# Media Service — Правила валидации

## Общие принципы

- Валидация на уровне DTO + бизнес-валидации.
- Жёстко контролируемые статусные переходы.
- Строгие требования к привязкам (Atlas/Pulse), если они используются.

## Обязательные поля при создании статьи

- `title` — не пустое, 3–200 символов.
- `description_short` — 20–500 символов.
- `content` — не пустое (кроме черновиков, где допустимо минимальное содержимое).
- `type` — одно из допустимых значений.
- `category_id` — существующая категория.
- `language` — поддерживаемый код (напр. `ru`, `en`).

## Slug и SEO

- `slug`:
  - уникален в рамках `language`,
  - только допустимые символы (латиница, цифры, дефисы),
  - генерация по названию, с авто-добавлением суффиксов при конфликте.

## Привязки к экосистеме

- `country_id`, `city_id`, `place_id`:
  - при необходимости валидируются через Atlas (в синхронном или асинхронном режиме).
- `event_id`:
  - может проверяться через Pulse (`GET /events/{id}`).
- `partner_id`:
  - должен существовать в RF Service (для статей партнёров).  

## Статуса и переходы

- `draft`:
  - можно создавать и редактировать автору/редактору.
- `pending_review`:
  - ставится при отправке на модерацию;
  - редактирование ограничено (в основном редакторами).
- `scheduled`:
  - статус только при наличии будущего `scheduled_at`;
  - изменение `scheduled_at` требует валидного будущего времени.
- `published`:
  - возможен только, если:
    - заполнены обязательные поля (контент, SEO минимум),
    - язык, категория, привязки корректны.
- `rejected`:
  - только после `pending_review`.
- `archived`:
  - из `published`.

Запрещённые переходы:

- `archived` → `published` (вместо этого создаётся новая версия или явно разрешается редактирование с особой логикой).
- `rejected` → `published` без повторного рассмотрения/изменения.

## Ограничения по длине и формату

- `title`: ≤ 200 символов.
- `subtitle`: ≤ 200.
- `description_short`: ≤ 500.
- `seo_title`: ≤ 200.
- `seo_description`: ≤ 300.
- `tags`:
  - до 20 тегов,
  - каждый — ≤ 32 символа.

## Проверки для источников

- `source_type = partner`:
  - требуется `partner_id`.
- `source_type = pro`:
  - автор должен иметь роль PRO (по данным User Service/Space).
- `source_type = ugc_space_post`:
  - нужен валидный `space_post_id`,
  - импортируемый контент должен быть доступен (не удалён, не скрыт модерацией Space).  

## Антиспам и модерация (Фаза 2)

- Лимит числа статей от одного автора за период (например, 5 в день).
- Автоматический контент-фильтр:
  - детекция запрещённой лексики/тем,
  - эскалация на ручную модерацию.
