# Media Service — Стратегия кеширования

## Задачи кеша

- Ускорение выдачи:
  - главной ленты блога;
  - рубричных лент;
  - блоков статей по городам/странам/местам/событиям.
- Снижение нагрузки на БД при росте трафика.

## Уровни кеширования

### 1. Response Cache (HTTP-уровень)

- `GET /articles` c типичными параметрами:
  - главная: без фильтров (или `type=news`),
  - по `category_id`,
  - по `city_id`.
- TTL: 30–120 секунд (зависит от динамичности контента).

- `GET /articles/{id_or_slug}`:
  - TTL: 30–60 секунд, чтобы выдерживать пики трафика при расшаривании статей.

### 2. Кеш для виджетов (Atlas/Pulse/Guru)

- `GET /articles/by-location`
- `GET /articles/by-event`

Часто используются в виджетах, можно кешировать:

- по ключу (`city_id`, `place_id`, `event_id`),
- TTL: 60–300 секунд.

### 3. Кеш справочников

- Категории и теги:
  - меняются редко,
  - TTL: 10–30 минут или in-memory.

## Инвалидирование кеша

- При публикации/обновлении/архивации статьи:
  - сбрасываются:
    - главная лента,
    - ленты по категории/городу/месту/событию, к которым привязана статья,
    - кеш статьи по `id` и `slug`.

Простой подход:

- при любом изменении статьи — сброс всех “очевидных” ключей,
- TTL достаточно короткий, чтобы обеспечить eventual consistency.

## Технологии

- Redis как основной стор для кеша.
- In-memory кеш на уровне инстанса для:
  - категорий,
  - самых базовых конфигов.
