# Media Service — Безопасность и доступ

## Аутентификация

- JWT от User Service для всех небезопасных операций:
  - создание/обновление статей,
  - изменение статуса,
  - импорт контента из Space,
  - управление категориями/тегами.
- Публичные `GET`:
  - ленты и статьи со `status = published` доступны без токена.

## Роли и права

Основные роли (из JWT):

- `user` — обычный пользователь:
  - нет доступа к Media API на запись.
- `pro`:
  - может создавать/редактировать свои статьи,
  - отправлять их на модерацию (`pending_review`).
- `partner`:
  - то же, плюс привязка к `partner_id`.
- `editor`:
  - может редактировать любые статьи,
  - публиковать/отклонять/архивировать,
  - управлять категориями/тегами.
- `admin`:
  - полные права, в том числе системные настройки.

**Примеры:**

- `POST /articles`:
  - `pro`, `partner`, `editor`, `admin`.
- `PATCH /articles/{id}`:
  - владелец (author_user_id) для `draft/pending_review`,
  - `editor/admin` — всегда.
- `POST /articles/{id}/publish`:
  - только `editor/admin`.

## Межсервисная безопасность

- mTLS и ролевой доступ между сервисами:
  - отдельные сервисные аккаунты для Media ↔ Atlas/Pulse/Content/Connect/Notification.  

## Логирование и аудит

- Логируются:
  - создание, изменения статус/стадий,
  - импорт из Space,
  - публикация и архивация,
  - модераторские действия (кто опубликовал/отклонил).
- В логах — `correlation-id` для отслеживания сквозных запросов.:contentReference[oaicite:37]{index=37}  

## Rate limiting

(Фаза 2)

- Ограничение числа запросов:
  - на создание/редактирование статей от одного пользователя/партнёра;
  - на публичные `GET /articles` с одного IP.

## Защита контента

- Санитайзинг HTML/разметки:
  - чтобы не пропускать XSS в встраиваемом контенте;
- Медиа-файлы:
  - загружаются в отдельное хранилище (CDN/облако),
  - Media хранит только безопасные URL.:contentReference[oaicite:38]{index=38}  
