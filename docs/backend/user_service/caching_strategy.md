# User Service — Caching Strategy

## Цели кеширования

- Ускорить частые операции:
  - валидация токенов (особенно refresh/blacklist),
  - получение профиля пользователя по `user_id` или `username`,
  - валидация токенов сброса пароля/подтверждения email.

---

## Кеши

### 1. Профили пользователей

- Ключ: `user:profile:{user_id}`
- Значение: сериализованный объект профиля (часто используемая часть `/me` / public profile).
- TTL: 5–15 минут.
- Инвалидация:
  - при обновлении профиля (`PATCH /me`) — прямой сброс ключа.
  - при смене роли — тоже.

### 2. Username → user_id

- Ключ: `user:username:{username}` → `user_id`.
- TTL: может быть большим (1–24 часа).
- Инвалидация при смене username.

### 3. Password reset / email confirm токены

- Ключ: `user:reset:{token}`, `user:verify:{token}`.
- Значение: `user_id` + metadata.
- TTL: 15–60 минут.
- После использования — ключ удаляется.

### 4. Token blacklist / session store (опционально)

- Если нужен централизованный blacklist:
  - `user:token:blacklist:{jti}` → boolean, TTL до истечения токена.

---

## Антипаттерны

- Не кешировать:
  - email-адреса в открытом виде,
  - чувствительные поля (пароль, hash, токены).
- Не класть в кеш больше данных, чем реально нужно для быстрых public-операций.
