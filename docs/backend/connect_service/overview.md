# Connect Service — Обзор

## Назначение

**Connect Service** — это оркестратор офчейн-экономики экосистемы Go2Asia.

Его задача — связать воедино:

- действия пользователя во всех модулях (Atlas, Pulse, Blog, Guru, RF, Rielt, Quest, Space и др.),
- события, поступающие от микросервисов (Referral, Voucher, Reactions, Rielt, RF, Quest и др.),
- бизнес-правила токеномики (кто и за что получает Points, NFT, статусы VIP/PRO, бонусы за ваучеры и т.п.),
- исполнение наград через:
  - **Points Service** (начисление/списание Points и, опционально, off-chain G2A),
  - **NFT Service** (выдача и управление NFT-бейджами),
  - **Blockchain Gateway Service** (mint/burn/transfer on-chain активов при необходимости).

Ключевой принцип: **Connect Service никогда не хранит балансы.**
Он:

- принимает *нормализованные экономические события*,
- применяет к ним набор правил (rule engine),
- создаёт *команды наград* (reward actions) для Points/NFT/Blockchain,
- логирует историю экономических решений и причин начислений.

## Зона ответственности

Connect Service отвечает за:

- интерпретацию событий:
  - `referral.joined`,
  - `referral.upgraded_to_vip`,
  - `quest.completed`,
  - `voucher.premium_purchased`,
  - `rielt.booking_paid`,
  - `reaction.repost`,
  - `reaction.short_review`,
  - `reaction.completed`,
  - `rf_partner.review_high_rating`,
  - и т.д.;
- применение правил токеномики:
  - сколько Points начислить за каждый тип события и при каких условиях,
  - при каких условиях выдать NFT-бейдж,
  - как работают многоступенчатые реферальные награды (реферал / субреферал),
  - какие награды «замораживаются» до момента апгрейда пользователя до VIP/PRO;
- формирование команд:
  - `Points.credit(user, amount, reason, metadata)`,
  - `NFT.mint(user, badge_type, metadata)`,
  - запросов в Blockchain Gateway (если часть награды должна быть on-chain);
- учёт и аудит:
  - записывает, какие награды были выданы по какому событию,
  - не допускает повторной обработки одинаковых событий (idempotency).

Connect Service **не**:
- хранит детальные данные о местах, бронированиях, квестах и т.д.,
- проводит оплату/биллинги (это делает соотв. доменный сервис),
- управляет реферальным деревом (этим занимается Referral Service),
- управляет балансами (Points Service) или on-chain кошельками (Blockchain Gateway).

## Роль в общей архитектуре

В архитектуре Go2Asia Connect Service — это **единая экономическая шина**:

- все микросервисы «сообщают» о значимых событиях (через Event Bus или internal API),
- Connect Service решает, какие поощрения выдавать:
  - пользователям (Spacers/VIP/PRO),
  - бизнес-партнёрам (RF-партнёры, хосты жилья),
  - PRO-спейсерам как создателям квестов/маршрутов/вовлечения в бизнес;
- Connect Service декомпозирует высокоуровневые «экономические решения» в конкретные операции над счётами и NFT.

Это позволяет:

- централизованно изменять экономику (куда, сколько и за что начисляется),
- запускать кампании (акции, бонусы, коэффициенты x2/x3),
- отслеживать влияние изменений токеномики, не залезая в код десятка доменных сервисов.
